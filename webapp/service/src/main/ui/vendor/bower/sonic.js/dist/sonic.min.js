/*!
Sonic.js v0.5.49
Copyright 2014 Commonwealth Computer Research, Inc.
Licensed under the Apache License, Version 2.0 (https://github.com/ccri/sonic.js/blob/master/LICENSE).
*/
(function(){function e(){var e=sonic.argsToArr(arguments);return e[0].componentSingleton().add.apply(null,e.slice(1))}function t(){var e=sonic.argsToArr(arguments);return e[0].componentSingleton().findAll.apply(null,e.slice(1))}function n(){var e=sonic.argsToArr(arguments);return e[0].componentSingleton().findOne.apply(null,e.slice(1))}function i(){var e=sonic.argsToArr(arguments);return e[0].componentSingleton().find.apply(null,e.slice(1))}function o(){var e=sonic.argsToArr(arguments);return e[0].componentSingleton().remove.apply(null,e.slice(1))}function a(e,t){e.listenerSingleton().add(t)}function c(e,t){e.listenerSingleton().remove(t)}function r(e,t){e.tooltipSingleton().add(t)}function l(e,t){e.tooltipSingleton().remove(t)}function s(e,t){e.tooltipSingleton().show(t)}function d(e,t){e.tooltipSingleton().hide(t)}function f(e,t){var n=[];return e.forEach(function(e){var i;t.series&&-1===t.series.indexOf(e.key)||sonic.isArray(e.values)&&0!==e.values.length&&(i=d3.extent(e.values,function(e){return e[t.dataKey]}),sonic.isSet(i[0])&&(n[0]=sonic.isSet(n[0])?Math.min(i[0],n[0]):i[0]),sonic.isSet(i[1])&&(n[1]=sonic.isSet(n[1])?Math.max(i[1],n[1]):i[1]))}),sonic.isSet(t.min)&&"none"!==t.min&&(n[0]=t.min),sonic.isSet(t.max)&&(n[1]=t.max),n}function u(e,t,n){var i;return sonic.isArray(n)?(i=n.map(function(n){var i,o=n;return(sonic.isString(n)||sonic.isNumber(n)&&1>=n)&&(sonic.isString(n)&&n.match(/%/)&&(i=parseInt(n.replace(/%/,""),10)/100),sonic.isNumber(n)&&(i=n),o="left"===t||"right"===t?i*e.body().height():i*e.body().width()),o}),("left"===t||"right"===t)&&(i=d3.permute(i,[1,0]))):i="left"===t||"right"===t?[e.body().height(),0]:[0,e.body().width()],i}function g(e){return Math.abs(e.rangeMax()-e.rangeMin())}function y(e,t){e.body().call(sonic.heatmap(e,t))}function p(e,t){e.find("sonic-heatmap",t).forEach(function(e){e.mergeConfig(e),e.update()})}function h(e,t){e.body().call(sonic.point(e,t))}function m(e,t){e.remove("sonic-point",t)}function S(e,t,n){e.find("sonic-point",t).forEach(function(e){e.mergeConfig(n),e.update()})}function x(e,t,n){e.find("sonic-point",t).forEach(function(e){e.updatePoint(n)})}function v(e,t){e.body().call(sonic.network(e,t))}function b(e,t){e.remove("sonic-network",t)}function k(e,t,n){e.find("sonic-network",t).forEach(function(e){e.mergeConfig(n),e.update()})}function K(e,t){e.body().call(sonic.tree(e,t))}function D(e,t){e.remove("sonic-tree",t)}function w(e,t,n){e.find("sonic-tree",t).forEach(function(e){e.mergeConfig(n),e.update()})}function P(e,t){e.body().call(sonic.boxAndWhisker(e,t))}function C(e,t,n){e.find("sonic-box-and-whisker",t).forEach(function(e){e.mergeConfig(n),e.update()})}function I(e,t){e.remove("sonic-box-and-whisker",t)}function M(e,t){e.body().call(sonic.line(e,t))}function z(e,t){e.remove("sonic-line",t)}function T(e,t,n){e.find("sonic-line",t).forEach(function(e){e.mergeConfig(n),e.update()})}function A(e,t){e.body().call(sonic.line.difference(e,t))}function O(e,t){e.remove("sonic-difference",t)}function E(e,t){e.body().call(sonic.line.forecast(e,t))}function F(e,t){e.body().call(sonic.line.rule(e,t))}function B(e,t){e.remove("sonic-rule",t)}function j(e,t){F(e,sonic.object.merge({type:"x",followMouse:!0,stroke:"#4CC417"},t)),F(e,sonic.object.merge({type:"y",followMouse:!0,stroke:"#4CC417"},t))}function W(e,t,n){e.find("sonic-rule",t).forEach(function(e){e.mergeConfig(n),e.update()})}function L(e,t){e.body().call(sonic.bar(e,t))}function G(e,t,n,i){var o=i||"sonic-bar";e.find(o,t).forEach(function(e){e.mergeConfig(n),e.update()})}function R(e,t){e.remove("sonic-bar",t)}function _(e,t){e.body().call(sonic.bar.significance(e,t))}function N(e,t,n){e.find("sonic-significance-bar",t).forEach(function(e){e.mergeConfig(n),e.update()})}function V(e,t){e.body().call(sonic.bar.overlay(e,t))}function q(e,t){e.remove("sonic-bar-overlay",t)}function H(e,t){e.body().call(sonic.bar.matrix(e,t))}function Y(e,t){e.body().call(sonic.area(e,t))}function Z(e,t,n){e.find("sonic-area",t).forEach(function(e){e.mergeConfig(n),e.update()})}function X(e,t){e.remove("sonic-area",t)}function U(e,t){e.body().call(sonic.pie(e,t))}function Q(e,t){e.body().call(sonic.hpie(e,t))}function $(e,t,n){e.find("sonic-hpie",t).forEach(function(e){e.highlightSlices(n)})}function J(e,t){e.body().call(sonic.punchcard(e,t))}function et(e,t){e.remove("sonic-punchcard",t)}function tt(e,t,n){e.find("sonic-punchcard",t).forEach(function(e){e.mergeConfig(n),e.update()})}function nt(e,t){e.body().call(sonic.geo.choropleth(e,t))}function it(e,t,n){e.find("sonic-choropleth",t).forEach(function(e){e.mergeConfig(n),e.update()})}function ot(e,t){e.remove("sonic-choropleth",t)}function at(e,t){e.body().call(sonic.legend(e,t))}function ct(e,t){e.remove("sonic-legend",t)}function rt(e,t,n){e.find("sonic-legend",t).forEach(function(e){e.mergeConfig(n),e.update()})}sonic={},sonic.augment=function(){var e=sonic.argsToArr(arguments),t=e.shift(),n=e.shift(),i=e.shift();e.forEach(function(e){var o=sonic.object.getProp(sonic,e)(t,n,i);sonic.each(o,function(n,i){sonic.isFunction(i)?sonic.isSet(sonic.object.getProp(t,n))?sonic.object.getProp(t,n).override||console.error(Error("The fn "+n+" of mixin "+e+"is already defined. "+"Please specify override or reconsider the naming of the fn").stack):sonic.object.setProp(t,n,function(){return i.apply(t,arguments)}):sonic.isSet(sonic.object.getProp(t,n))?(sonic.object.merge(i,sonic.object.getProp(t,n)),sonic.object.merge(sonic.object.getProp(t,n),i)):sonic.object.setProp(t,n,i)})})},sonic.override=function(e){return e.override=!0,e},sonic.timezone="UTC",sonic.isSet=function(e){return void 0!==e&&null!==e?!0:!1},sonic.isBoolean=function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},sonic.isNumber=function(e){return"[object Number]"===Object.prototype.toString.call(e)},sonic.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},sonic.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},sonic.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},sonic.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},sonic.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},sonic.isRegex=function(e){return e instanceof RegExp},sonic.isNest=function(e){return sonic.isArray(e)&&e.length>0&&sonic.isSet(e[0].key)&&sonic.isSet(e[0].values)?!0:!1},sonic.random=function(e,t){return Math.random()*(t-e)+e},sonic.randomInteger=function(e,t){return Math.round(sonic.random(e,t))},sonic.doIfSet=function(e,t){void 0!==t&&e(t)},sonic.getOrSet=function(e,t,n,i){return sonic.isSet(t)?(sonic.isObject(n[e])&&sonic.isObject(t)?sonic.object.merge(n[e],t):n[e]=t,i?i:n):n[e]},sonic.clone=function(e){var t,n;if(!sonic.isSet(e))return e;if(sonic.isDate(e))return new Date(e.getTime());if(sonic.isArray(e)){t=e.length-1,n=[];do n[t]=sonic.clone(e[t]),t-=1;while(t>=0)}return sonic.isObject(e)&&(n={},sonic.each(e,function(e,t){n[e]=sonic.clone(t)})),n||e},sonic.string={},sonic.capFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},sonic.string.isNumeric=function(e,t){var n="^[0-9]*[.]{0,1}[0-9]+$";return t&&(n="^[0-9]+$"),RegExp(n).test(e)},sonic.array={},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n,i;for(n=t||0,i=this.length;i>n;n+=1)if(this[n]===e)return n;return-1}),sonic.argsToArr=function(){var e=arguments;return Array.prototype.slice.call(e[0],0)},sonic.sortByProp=function(e,t){return function(n,i){var o=sonic.object.getProp(n,e),a=sonic.object.getProp(i,e);return sonic.isDate(o)&&(o=o.getTime()),sonic.isDate(a)&&(a=a.getTime()),a>o?t?1:-1:o>a?t?-1:1:0}},sonic.array.maxLength=function(e){return e.reduce(function(e,t){return Math.max(e,sonic.isArray(t)?t.length:t.values.length)},0)},sonic.array.random=function(e){return sonic.isArray(e)&&0!==e.length?e[sonic.randomInteger(0,e.length-1)]:void 0},sonic.array.remove=function(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)},sonic.array.add=function(e,t,n){n&&e.indexOf(t)>=0||e.push(t)},sonic.array.contains=function(e,t){var n;return e?n=sonic.isDate(t)?e.some(function(e){return sonic.isDate(e)&&e.getTime()===t.getTime()}):-1!==e.indexOf(t):!1},sonic.array.pluck=function(e,t){return e.map(function(e){return sonic.object.getProp(e,t)})},sonic.array.binarySearch=function(e,t){for(var n,i,o=0,a=e.length-1;a>=o;)if(n=Math.floor((o+a)/2),i=t(e[n]),0>i)o=n+1;else{if(!(i>0))return n;a=n-1}return null},sonic.array.find=function(e,t){return e.filter(function(e){var n=!0;return sonic.each(t,function(t,i){var o=sonic.object.getProp(e,t),a=i;return sonic.isFunction(i)&&(a=i()),o!==a?(n=!1,!1):void 0}),n})},sonic.array.findOne=function(e,t){var n=sonic.array.find(e,t);return 0===n.length?null:n[0]},sonic.array.unique=function(e){return sonic.isArray(e)&&!sonic.isArray(e[0])&&(e=[e]),e.reduce(function(e,t){return e.concat(t.filter(function(t){return!sonic.array.contains(e,t)}))},[])},sonic.object={},sonic.each=function(e,t,n){var i,o;for(i in e)if(e.hasOwnProperty(i)&&(o=t.call(n||e[i],i,e[i]),o===!1))return},sonic.object.keys=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n},sonic.object.values=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(e[t]);return n},sonic.object.merge=function(e,t){var n;if(t)for(n in t)t.hasOwnProperty(n)&&(sonic.isObject(e[n])&&sonic.isObject(t[n])?sonic.object.merge(e[n],t[n]):e[n]=t[n]);return e},sonic.object.equalize=function(e,t){sonic.object.merge(t,sonic.object.merge(e,t))},sonic.object.getProp=function(e,t){var n=e;return t.split(".").forEach(function(e){n=n[e]}),n},sonic.object.setProp=function(e,t,n){var i=e,o=t.split("."),a=o.pop();return o.forEach(function(e){i=i[e],sonic.isSet(i)||(i[e]={},i=i[e])}),i[a]=n,e},sonic.nest=function(e){function t(){var t=[];return sonic.isNest(e)?t=e:sonic.isObject(e)?t=n(e):sonic.isArray(e)&&(t=i(e)),sonic.isSet(t)?t:[]}function n(e){return d3.entries(e)}function i(e){return sonic.isArray(e)&&!sonic.isArray(e[0])&&(e=[e]),e.map(function(e,t){return{key:t,values:e}})}return t()},sonic.nest.findByKey=function(e,t){var n;return e.forEach(function(e){e.key===t&&(n=e)}),n},sonic.colors={},sonic.colors.colorMap=function(e,t){var n,i=0,o=t||d3.map(),a=e||["#EE0000","#EE5500","#DDDD00","#00CC00","#0000EE","#770077","#DD00DD","#880000","#FF3300","#CC9900","#009999","#006600","#00008F","#440044","#FF0066"];return o.values().forEach(function(e){var t=a.indexOf(e);t>=0&&(a.splice(t,1),a.push(e))}),n=function(e){return o.has(e)||(o.set(e,a[i%a.length]),i=(i+1)%a.length),o.get(e)},n.remove=function(e){var t=o.get(e),n=a.indexOf(t);a.splice(n,1),i>n&&(i-=1),a.splice(i,0,t)},n},sonic.colors.generateGradient=function(e,t,n){if(t.length!==e.length){var i=(t[1]-t[0])/(e.length-1);t=d3.range(t[0],t[1]+i,i)}return n?sonic.colors.generateDiscreteColorGradient.call(this,e,t,n):sonic.colors.generateContinuousColorGradient.call(this,e,t)},sonic.colors.generateDiscreteColorGradient=function(e,t,n){var i=d3.map(),o=d3.rgb(e.shift()),a=t.shift();return t.forEach(function(c,r){var l=(c-a)/n,s=d3.rgb(e[r]),d=(s.r-o.r)/n,f=(s.g-o.g)/n,u=(s.b-o.b)/n;d3.range(a,c+(r===t.length-1?l:0),l).forEach(function(e,t){i.set(e,d3.rgb(o.r+d*t,o.g+f*t,o.b+u*t))}),o=s,a=c}),{getColor:function(e){var t;return i.keys().some(function(n){var i=parseFloat(n);return!sonic.isSet(t)||e>i?(t=i,!1):(Math.abs(e-i)<Math.abs(e-t)&&(t=i),!0)}),i.get(t)}}},sonic.colors.generateContinuousColorGradient=function(e,t){function n(e){var n=d3.bisect(t,e);return n===t.length&&(n-=1),[n-1,n]}return{getColor:function(i){var o=n(i),a=d3.rgb(e[o[0]]),c=d3.rgb(e[o[1]]),r=c.r-a.r,l=c.g-a.g,s=c.b-a.b,d=(i-t[o[0]])/(t[o[1]]-t[o[0]]);return d3.rgb(a.r+r*d,a.g+l*d,a.b+s*d)}}},sonic.registerable=function(e,t){var n={},i={data:[],selection:null,config:{id:null}};return n.id=function(n){return sonic.getOrSet("id",n,t.config,e)},n.mergeConfig=function(e){sonic.object.merge(t.config,e)},n.update=function(i){var o={update:!0};sonic.isSet(i)&&(i.type!==t.config.type&&(o.from=i.type),n.mergeConfig(i)),t.selection.call(e,o)},n.remove=function(){t.selection.call(e,{remove:!0})},n.hasContent=function(){return t.data.length>0},sonic.object.equalize(i,t),n},sonic.listenable=function(e,t,n){var i={},o={config:{}};return i.handleEvent=function(e,n,i){var o;return"vizbodywide"===e?"mousemove"===n?o=t.onVizMouseMove?t.onVizMouseMove(i):null:"mouseout"===n?o=t.onVizMouseMove?t.onVizMouseMove():null:"click"===n&&(o=t.onVizClick?t.onVizClick(i):null):".clear-link"===e&&"click"===n&&(o=t.onVizClick?t.onVizClick():null),o},o.updateTooltips=function(i,o){var a=t.renderTooltips;t.config.tooltip&&t.config.tooltip.renderFn&&(a=t.config.tooltip.renderFn),t.config.tooltip&&(i&&o&&o.length>0?(t.config.tooltip.closestPoints=o,t.config.tooltip.content=a(o,i),t.config.tooltip.associatedId=e.id(),t.config.tooltip.mouse=i,n.showTooltip(t.config.tooltip)):n.hideTooltip(t.config.tooltip))},sonic.object.equalize(o,t),i};var lt=function lt(){function e(){}var t=d3.map();return e.methods=function(){return t},e.add=function(e,n){t.set(e,n)},e.remove=function(e){t.remove(e)},e}();sonic.registry=function(){function e(){}function t(e){return e+"-"+Math.floor(1e4*Math.random())}var n=d3.map(),i=[];return e.components=function(){return n},e.add=function(e,o){var a,c=sonic.isFunction(o.id)&&sonic.isSet(o.id());return n.has(e)||n.set(e,d3.map()),a=c?o.id():t(e),n.get(e).has(a)||(!c&&sonic.isFunction(o.id)&&o.id(a),n.get(e).set(a,o),sonic.array.contains(i,a)||i.push(a)),a},e.findAll=function(){return n.entries()},e.findOne=function(t,n){var i=e.find(t,n),o=null;return i[0]&&(o=i[0]),o},e.find=function(e,t){var i,o,a=[];return t=t||{},n.has(e)?(i=n.get(e),sonic.isString(t)?(o=i.get(t),sonic.isSet(o)?[i.get(t)]:[]):sonic.isSet(t.id)?sonic.isString(t.id)?(o=i.get(t.id),sonic.isSet(o)?[o]:[]):i.entries().map(function(e){return e.value}).filter(function(e){return t.id.test(e.id())}):(n.get(e).forEach(function(e,n){var i,o=!0;for(i in t)t.hasOwnProperty(i)&&(sonic.isFunction(n[i])?n[i]()!==t[i]&&(o=!1):o=!1);o&&a.push(n)}),0===a.length?[]:a)):[]},e.applyFn=function(e,t){n.forEach(function(n,i){i.forEach(function(n,i){sonic.isFunction(i[e])&&i[e].apply(i,t)})})},e.update=function(){n.has("scale")&&n.get("scale").forEach(function(e,t){t.update()}),n.forEach(function(e,t){"scale"!==e&&t.forEach(function(e,t){sonic.isFunction(t.update)&&t.update()})})},e.refresh=function(e){n.forEach(function(t,n){"scale"!==t&&n.forEach(function(t,n){t!==e&&n.update()})})},e.remove=function(e,t){var i,o=[];return n.has(e)?(i=n.get(e),sonic.isSet(t)?sonic.isString(t)?o.push(i.get(t)):sonic.isSet(t.id)&&o.push(i.get(t.id)):o=o.concat(i.values()),o.forEach(function(e){e.remove(),i.remove(e.id())}),void 0):[]},e.visibleContent=function(){return i},e.registerVisibleContent=function(e,t){t?sonic.array.add(i,e.id(),!0):sonic.array.remove(i,e.id())},e},lt.add("register",e),lt.add("findAll",t),lt.add("findOne",n),lt.add("find",i),lt.add("remove",o),sonic.listener=function(e,t){function n(){}function i(e){return"mousemove"===e&&o===!1}var o,a={};return n.add=function(t){sonic.each(t,function(t,n){a[t]||(a[t]={}),sonic.each(n,function(n,i){(!sonic.isSet(i)||sonic.isFunction(i))&&(i={fn:i}),a[t][n]||(a[t][n]=[]),i.scope=i.scope||e,a[t][n].push(i)})}),n.rebind()},n.remove=function(e){sonic.isSet(e)?sonic.each(e,function(e,t){"all"===t?delete a[e]:a[e]&&t.forEach(function(t){delete a[e][t]})}):a={},n.rebind()},n.rebind=function(){var n="handleEvent";sonic.each(a,function(a,c){sonic.each(c,function(c,r){var l=e.container();"vizbodywide"!==a&&(l=l.selectAll(a)),l.on(c,function(){var s=[],d=c,f=e.mouse(l[0][0]);if("vizbodywide"===a)if(e.mouse.inBody(f))o=!1;else{if(!i(d))return;d="mouseout",o=!0}t&&t.components().forEach(function(e,t){t.forEach(function(e,t){var i,o=t[n];sonic.isFunction(o)&&(i=o.apply(t,[a,d,f]),sonic.isSet(i)&&(s=s.concat(i)))})}),r.forEach(function(e){sonic.isSet(e)&&sonic.isFunction(e.fn)&&e.fn.call(e.scope,s)})})})})},n},lt.add("addListeners",a),lt.add("removeListeners",c),sonic.tooltip=function(e,t){function n(e){var t;i.selection=e,i.computeData(),t=i.selection.selectAll(".sonic-tooltip").data(i.data,function(e){return e.key}),t.enter().insert("div",":first-child").classed("sonic-tooltip",!0),t.each(i.drawTooltips),t.exit().remove()}var i={tips:d3.map(),config:{position:"mouse",offset:[10,0],renderFn:null}};return n.tooltips=function(){return i.tips},n.add=function(t){i.tips.has(t.associatedId)||(i.tips.set(t.associatedId,t),d3.select(e.elId()).call(n))},n.update=sonic.override(function(t){i.tips.has(t.associatedId)&&(i.tips.set(t.associatedId,t),d3.select(e.elId()).call(n))}),n.remove=sonic.override(function(t){i.tips.has(t.associatedId)&&(i.tips.remove(t.associatedId),d3.select(e.elId()).call(n))}),n.show=function(e){e.visible=!0,i.tips.has(e.associatedId)?n.update(e):n.add(e)},n.hide=function(e){e.visible=!1,n.update(e)},i.computeData=function(){var e=[];i.data=[],i.tips.forEach(function(t,n){var o={key:t,value:n};n.visible&&("global"===n.type?e.push(o):i.data.push(o))}),e.length>0&&i.data.push({key:"global",values:e.sort(function(e,t){var n=sonic.isSet(e.value.priority)?e.value.priority:-1,i=sonic.isSet(t.value.priority)?t.value.priority:-1;return n===i?0:-1===n&&-1!==i?1:-1===i&&-1!==n?-1:i>n?-1:n>i?1:0})})},i.drawTooltips=function(e){var t,n=e.key,o=d3.select(this);t="global"===n?i.drawGlobalTooltip(e,o):i.drawComponentTooltip(e,o),o.style("display",function(){return t.visible?"block":"none"}),t.position.forEach(function(e,t){o.style(e,null===t?null:t+"px")}),o.html(t.html)},i.drawGlobalTooltip=function(e){var t,n=[],o={visible:!1,html:"",position:null};return e.values.forEach(function(e){e.value.visible&&(o.visible=!0),i.config.renderFn?n=n.concat(e.value.closestPoints):o.html+=e.value.content}),t=e.values[0].value.mouse,i.config.renderFn&&(o.html=i.config.renderFn(n,t)),o.position="mouse"===i.config.position?i.calculateMousePosition(t):i.calculateFixedPosition(i.config.position),o},i.drawComponentTooltip=function(e,t){var n={visible:!1,html:"",position:null};return e.value.visible&&(n.visible=!0),n.html=i.config.renderFn?i.config.renderFn(e.value.closestPoints):e.value.content,n.position="fixed"===e.value.position||sonic.isArray(e.value.position)?i.calculateFixedPosition(e.value.position,e.value.offset):i.calculateMousePosition(e.value.mouse,e.value.offset,t),n},i.calculateMousePosition=function(t,n){var o,a,c=d3.map(),r="left",l="top",s=e.currentPadding(),d=e.margin();return n=n||i.config.offset,o=t[0]+n[0],a=t[1]-n[1],c.set("left",null),c.set("right",null),c.set("top",null),c.set("bottom",null),t[0]>=e.body().width()/2?(r="right",o=e.body().width()-t[0]+s.right+d.right+n[0]):o=o+s.left+d.left,t[1]>=e.body().height()/2?(l="bottom",a=e.body().height()-t[1]+s.bottom+d.bottom-n[1]):a=a+s.top+d.top,c.set(r,o),c.set(l,a),c},i.calculateFixedPosition=function(t,n){var o=d3.map();return n=n||i.config.offset,sonic.isSet(t)&&"fixed"!==t||(t=["left","top"]),n=n||[0,0],isNaN(t[0])?"right"===t[0]?o.set("right",e.margin().right+n[0]):o.set("left",e.margin().left+n[0]):o.set("left",e.margin().left+t[0]),isNaN(t[1])?"bottom"===t[1]?o.set("bottom",e.margin().bottom+n[1]):o.set("top",e.margin().top+n[1]):o.set("top",e.margin().top+t[1]),o},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),n},lt.add("addTooltip",r),lt.add("removeTooltip",l),lt.add("showTooltip",s),lt.add("hideTooltip",d),sonic.svg=function(){},sonic.svg.height=function(e){return e[0][0].getBoundingClientRect().height||parseInt(e[0][0].getAttribute("height"),10)},sonic.svg.width=function(e){return e[0][0].getBoundingClientRect().width||parseInt(e[0][0].getAttribute("width"),10)},sonic.svg.hasClass=function(e,t){var n,i,o=!1;if(i=e.getAttribute("class"))for(i=i.split(" "),n=0;i.length>n;n+=1)if(i[n]===t){o=!0;break}return o},sonic.currency={},sonic.currency.format=function(e,t){var n,i=",";return t=t||{},void 0===t.decimals&&(t.decimals=2),e>=1e9?(n="B",e/=1e9):e>=1e6?(n="M",e/=1e6):e>=1e3&&(n="K",e/=1e3),void 0!==t.decimals&&(i=i+"."+t.decimals+"f"),i=d3.format(i),(t.excludeDollar?"":"$")+i(e)+(n||"")},sonic.geom={},sonic.geom.pythagorize=function(e,t){return Math.sqrt(e*e+t*t)},sonic.scale={},sonic_scale_add=function(e,t){sonic.scale[t.type](e,t)},sonic_scale_add_linear=function(e,t){sonic_scale_add(e,sonic.object.merge(t,{type:"linear"}))},sonic_scale_add_time=function(e,t){sonic_scale_add(e,sonic.object.merge(t,{type:"linear"}))},sonic_scale_add_ordinal=function(e,t){sonic_scale_add(e,sonic.object.merge(t,{type:"linear"}))},sonic_scale_update=function(e,t,n){e.find("scale",t).forEach(function(e){e.mergeConfig(n),e.update()})},sonic_scale_remove=function(e,t){e.remove("scale",t)},lt.add("addScale",sonic_scale_add),lt.add("addLinearScale",sonic_scale_add_linear),lt.add("addOrdinalScale",sonic_scale_add_ordinal),lt.add("addTimeScale",sonic_scale_add_time),lt.add("updateScale",sonic_scale_update),lt.add("removeScale",sonic_scale_remove),sonic.scale.linear=function(e,t){function n(){i.d3Scale=d3.scale.linear().domain(i.computeDomain()),i.d3Scale.range(i.computeRange())}var i={d3Scale:null,config:{id:null,dataKey:null,pos:null,pad:{},range:null,minDomainRange:null}};return n.update=sonic.override(function(){n()}),n.scale=function(){return i.d3Scale},n.domain=function(e,t){return sonic.isSet(e)?(t?i.d3Scale.domain(d3.extent(i.d3Scale.domain().concat(e))):i.d3Scale.domain(e),void 0):i.d3Scale.domain()},n.resetDomain=function(){n.domain(i.computeDomain())},n.domainMin=function(e){var t,n=e;return sonic.isSet(e)?(sonic.isSet(i.config.min)||(i.config.pad.min&&(t=i.d3Scale.domain()[0],n=e-(i.d3Scale.domain()[1]-e)*i.config.pad.min,i.config.adjustNearZero&&0>=t*n&&(n=0)),i.d3Scale.domain([n,i.d3Scale.domain()[1]])),void 0):i.d3Scale.domain()[0]},n.domainMax=function(e){var t,n=e;return sonic.isSet(e)?(sonic.isSet(i.config.max)||(i.config.pad.max&&(t=i.d3Scale.domain()[1],n=e+(e-i.d3Scale.domain()[0])*i.config.pad.max,i.config.adjustNearZero&&0>=t*n&&(n=0)),i.d3Scale.domain([i.d3Scale.domain()[0],n])),void 0):i.d3Scale.domain()[1]},n.domainExtent=function(){return i.d3Scale.domain()[1]-i.d3Scale.domain()[0]},n.nearest=function(e,t){var n,o=e[i.config.dataKey];return sonic.each(t,function(e,t){var a;return a=Math.abs(t[i.config.dataKey]-o),sonic.isSet(n)||(n={}),(!sonic.isSet(n.dist)||n.dist>a)&&(n.point=t,n.dist=a,0===a)?!1:void 0}),n},n.sort=function(e){return e.sort(sonic.sortByProp(i.config.dataKey))},n.rangeInputs=function(){return i.config.range},n.resetScale=function(e){return this.range(e)},n.range=function(e){return sonic.isSet(e)?(i.config.range=e,i.d3Scale.range(i.computeRange()),n):i.d3Scale.range()},n.rangeExtent=function(){return g(n)},n.rangeMin=function(){return d3.min(i.d3Scale.range())},n.rangeMax=function(){return d3.max(i.d3Scale.range())},n.position=function(e){return i.d3Scale(e)},n.dataKey=function(){return i.config.dataKey},n.type=function(){return"linear"},i.computeDomain=function(){var t,n,o,a={};return t=f(e.data(),i.config),0===t.length?[0,1]:(t[0]===t[1]&&(n=5>.1*t[0]?5:.1*t[0],t[1]=t[1]+n),i.config.pad&&(i.config.pad.max&&(a.max=t[1],t[1]=t[1]+(t[1]-t[0])*i.config.pad.max,i.config.adjustNearZero&&0>=a.max*t[1]&&(t[1]=0)),i.config.pad.min&&(a.min=t[0],t[0]=t[0]-(t[1]-t[0])*i.config.pad.min,i.config.adjustNearZero&&0>=a.min*t[0]&&(t[0]=0))),i.config.minDomainRange&&t[1]-t[0]<i.config.minDomainRange&&(o=Math.ceil((i.config.minDomainRange-(t[1]-t[0]))/2),a.min=t[0],a.max=t[1],t[0]=t[0]-o,i.config.adjustNearZero&&0>=a.min*t[0]&&(t[0]=0,t[1]=t[1]+o),t[1]=t[1]+o,i.config.adjustNearZero&&0>=a.max*t[1]&&(t[1]=0,t[0]=t[0]-o)),t)},i.computeRange=function(){return u(e,i.config.pos,i.config.range)},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),n(),e.register("scale",n),n},sonic.scale.ordinal=function(e,t){function n(){i.d3Scale=d3.scale.ordinal().domain(i.computeDomain()).rangeBands(i.computeRange())}var i={d3Scale:null,config:{id:null,dataKey:null,pos:null,range:null,ticks:{sort:function(e,t){return t>e?-1:e>t?1:0}}}};return n.update=sonic.override(function(){n()}),n.scale=function(){return i.d3Scale},n.resetScale=function(e){return this.rangeBands(e)},n.rangeBands=function(e){return sonic.isSet(e)?(i.config.range=e,i.d3Scale.rangeBands(i.computeRange()),n):i.d3Scale.range()},n.rangeExtent=function(){return g(n)},n.rangeMin=function(){return d3.min(i.d3Scale.range())},n.rangeMax=function(){return d3.max(i.d3Scale.range())+n.rangeBand()},n.rangeBand=function(){return i.d3Scale.rangeBand()},n.position=function(e,t){var n=i.d3Scale(e);return"center"===t||"bin"===t?n+=i.d3Scale.rangeBand()/2:"max"===t&&(n+=i.d3Scale.rangeBand()),n},n.dataKey=function(){return i.config.dataKey},n.type=function(){return"ordinal"},i.computeDomain=function(){var t,n=[];return sonic.isArray(i.config.ticks.values)?n=i.config.ticks.values:e.data().forEach(function(e){e.values.forEach(function(e){var t=e[i.config.dataKey];-1===n.indexOf(t)&&n.push(t)})}),"BYVALUE"===i.config.ticks.sortType?e.data().length>0&&(t=sonic.clone(e.data()).sort(i.config.ticks.sort).map(function(e){return e.values.length>0?e.values[0][i.config.dataKey]:""}),n.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),n=t.filter(function(e){return""!==e})):i.config.ticks.sort&&(n=n.sort(i.config.ticks.sort)),n},i.computeRange=function(){return u(e,i.config.pos)},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),n(),e.register("scale",n),n},sonic.scale.time=function(e,t){function n(){i.d3Scale="UTC"===sonic.timezone?d3.time.scale.utc().domain(i.computeDomain()).range(i.computeRange()):d3.time.scale().domain(i.computeDomain()).range(i.computeRange())}var i={d3Scale:null,config:{id:null,dataKey:null,pos:null,range:null}};return n.update=sonic.override(function(){return n()}),n.scale=function(){return i.d3Scale},n.domain=function(e,t){return sonic.isSet(e)?(t?i.d3Scale.domain(d3.extent(i.d3Scale.domain().concat(e))):i.d3Scale.domain(e),void 0):i.d3Scale.domain()},n.resetDomain=function(){n.domain(i.computeDomain())},n.domainIntervalToRange=function(e){return i.d3Scale(new Date(i.d3Scale.domain()[0].getTime()+e))},n.domainRangeToInterval=function(e){return i.d3Scale.invert(e).getTime()-i.d3Scale.domain()[0].getTime()},n.resetScale=function(e){return this.range(e)},n.range=function(e){return sonic.isSet(e)?(i.config.range=e,i.d3Scale.range(i.computeRange()),n):i.d3Scale.range()},n.rangeExtent=function(){return g(n)},n.rangeMin=function(){return d3.min(i.d3Scale.range())},n.rangeMax=function(){return d3.max(i.d3Scale.range())},n.nearest=function(e,t){var n,o=e[i.config.dataKey];return sonic.each(t,function(e,t){var a;return a=Math.abs(t[i.config.dataKey].getTime()-o),sonic.isSet(n)||(n={}),(!sonic.isSet(n.dist)||n.dist>a)&&(n.point=t,n.dist=a,0===a)?!1:void 0}),n},n.sort=function(e){return e.sort(sonic.sortByProp(i.config.dataKey))},n.domainDistance=function(e,t){return e.getTime()-t.getTime()},n.numDays=function(){return d3.time.days(i.d3Scale.domain()[0],i.d3Scale.domain()[1])},n.position=function(e){return i.d3Scale(e)},n.invert=function(e){return i.d3Scale.invert(e)},n.dataKey=function(){return i.config.dataKey},n.type=function(){return"time"},i.computeDomain=function(){var t,n,o;return n=f(e.data(),i.config),0===n.length?[new Date(0),new Date(1e6)]:(n[0]=new Date(n[0]),n[1]=new Date(n[1]),n[0]===n[1]&&(t=36e5,o=n[0].getTime()%t,0===o?n[1]=new Date(n[1].getTime()+t):23===o?n[0]=new Date(n[1].getTime()-t):(n[0]=new Date(n[0].getTime()-t),n[1]=new Date(n[1].getTime()+t))),i.config.pad&&(i.config.pad.max&&(n[1]=new Date(n[1].getTime()+i.config.pad.max)),i.config.pad.min&&(n[0]=new Date(n[0].getTime()-i.config.pad.min))),n)},i.computeRange=function(){return u(e,i.config.pos)},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),n(),e.register("scale",n),n},sonic.axis=function(e,t){function n(t,o){i.selection=t,i.minPad=0,i.config.height=e.body().height(),i.config.width=e.body().width(),("left"===i.config.pos||"right"===i.config.pos)&&(i.config.orient="vert"),i.setScales(),i.config.edgeLength=i.scale.rangeExtent(),i.axe=d3.svg.axis().scale(i.scale.scale()).orient(i.config.pos),i.computePadding(),i.computeLabelPosition(),i.computeTicks(),i.drawAxis(t,o||{}),e.registerVisibleContent(n,!1)}var i={scale:null,axe:null,minPad:null,config:{pos:"bottom",range:null,orient:"horiz",cls:"x",dataKey:"x",type:"linear",pinTo:{scale:null,value:null},offset:{dx:null,dy:null},pad:{},ticks:{showLabels:!0,count:void 0,minHorizSpacing:80,minVertSpacing:30,padding:null,formatFn:null,subdivide:null,values:null,min:null,max:null,snapTo:null,rotate:null,textAnchor:null,dx:null,dy:null},label:{text:null,pos:"middle",rotate:null,x:null,y:null,dx:null,dy:null,padding:35}}};return n.currentPadding=function(){return e.currentPadding()},n.scale=function(){return i.scale},n.range=function(){return i.config.range},n.pos=function(){return i.config.pos},n.dataKey=function(){return i.config.dataKey},i.updatePadding=function(t){var o={};o[i.config.pos]=t,e.currentPadding(o,n.id()),i.config.height=e.body().height(),i.config.width=e.body().width()},i.checkAndSetPadding=function(t,n){var o=i.axe.tickSize(),a=i.computeTickPadding(),c=11,r=12,l=sonic.isSet(i.config.label.dy)?i.config.label.dy:0,s=sonic.isSet(i.config.label.dx)?i.config.label.dx:0,d=i.config.label.padding;"auto"===e.padding()[i.config.pos]&&"horiz"===t?n=o+a+c+l+r+10:"auto"===e.padding()[i.config.pos]&&"vert"===t&&(n=o+a+s+d+10),i.minPad=n,i.findSamePosAxis(i.config.pos,n)>e.currentPadding()[i.config.pos]&&i.updatePadding(n)},i.findSamePosAxis=function(t,n){var i,o=e.registry().find("sonic-axis");return o.forEach(function(e){e.pos()===t&&(i=n>e.currentPadding()[t]?n:e.currentPadding()[t])}),i},i.computePadding=function(){var t,n,o=e.padding()[i.config.pos];"horiz"===i.config.orient?(i.checkAndSetPadding(i.config.orient,o),sonic.isSet(i.config.range)||(t=sonic.isSet(i.config.offset.dx)?i.config.offset.dx:0,n=e.body().width(),i.scale.resetScale([t,n]))):(i.checkAndSetPadding(i.config.orient,o),sonic.isSet(i.config.range)||(t=sonic.isSet(i.config.offset.dy)?i.config.offset.dy:0,n=e.body().height(),i.scale.resetScale([t,n])))},i.computeOffset=function(){var t,n,o=i.config.offset.dx,a=i.config.offset.dy,c=!1;return sonic.isSet(o)||(o="right"===i.config.pos?i.config.width:0),sonic.isSet(a)||(a="bottom"===i.config.pos?i.config.height:0),sonic.isSet(i.config.pinTo.scale)&&(t=e.findOne("scale",{dataKey:i.config.pinTo.scale}),t&&(i.config.pinTo.value<t.domainMin()?(t.domainMin(i.config.pinTo.value),c=!0):i.config.pinTo.value>t.domainMax()&&(t.domainMax(i.config.pinTo.value),c=!0),c&&e.findOne("sonic-axis",{dataKey:i.config.pinTo.scale}).update(),n=t.position(i.config.pinTo.value),"horiz"===i.config.orient?a=n:o=n)),{x:o,y:a}},i.drawAxis=function(t,n){var o,a,c=i.computeOffset(),r=[i.config.cls,i.config.id,"major","sonic-axis"],l=[];n.remove||l.push(1),i.config.ticks.showMinor&&r.push("minor"),o=t.selectAll("g."+i.config.id).data(l),o.enter().insert("g",":first-child").classed(r.join(" "),!0).attr("transform","translate("+c.x+", "+c.y+")"),o.each(i.drawLabel),o.transition().delay(e.animation().delay).duration(e.animation().duration).attr("transform","translate("+c.x+", "+c.y+")").call(i.axe),a=o.selectAll("g.tick text").transition().delay(e.animation().delay).duration(e.animation().duration),sonic.isSet(i.config.ticks.textAnchor)&&a.style("text-anchor",i.config.ticks.textAnchor),sonic.isSet(i.config.ticks.rotate)&&a.attr("transform",function(){return"rotate("+(i.config.ticks.rotate||0)+")"}),sonic.isSet(i.config.ticks.dx)&&a.attr("dx",i.config.ticks.dx),sonic.isSet(i.config.ticks.dy)&&a.attr("dy",i.config.ticks.dy),o.exit().remove()},i.computeTickSize=function(){var e=i.config.ticks.size;return i.config.ticks.showMinor&&(e="vert"===i.config.orient?[-1*i.config.width,-1*i.config.width,0]:[-1*i.config.height,-1*i.config.height,0]),e},i.computeTickCount=function(){var e,t=i.config.ticks.count;return"ordinal"===i.config.type?t:(e="horiz"===i.config.orient?i.config.edgeLength/i.config.ticks.minHorizSpacing:i.config.edgeLength/i.config.ticks.minVertSpacing,t=e,i.config.ticks.count>e?t=e:"linear"===i.config.type&&"integer"===i.config.ticks.snapTo?t=t>i.scale.domainExtent()?i.scale.domainExtent():t:"time"===i.config.type&&"day"===i.config.ticks.snapTo&&(t=t>i.scale.numDays().length?i.scale.numDays().length:t),Math.floor(t))
},i.computeTickPadding=function(){var e=3;return sonic.isSet(i.config.ticks.padding)&&(e=i.config.ticks.padding),e},i.computeTickLabels=function(){var e=i.config.ticks.formatFn;return i.config.ticks.showLabels===!1&&(e=function(){return""}),e},i.computeTicks=function(){sonic.doIfSet(i.axe.ticks,i.computeTickCount()),sonic.doIfSet(i.axe.tickPadding,i.computeTickPadding()),sonic.doIfSet(function(e){i.axe.tickSize.apply(this,e)},i.computeTickSize()),sonic.doIfSet(i.axe.tickFormat,i.computeTickLabels()),sonic.doIfSet(i.axe.tickSubdivide,i.config.ticks.subdivide),sonic.doIfSet(i.axe.tickValues,i.config.ticks.values)},i.setScales=function(){sonic.isSet(i.config.scale)?(i.scale=i.config.scale,i.config.scaleId=i.scale.id(),delete i.config.scale):i.config.scaleId?i.scale=e.findOne("scale",i.config.scaleId):(i.scale=e.findOne("scale",{dataKey:i.config.dataKey}),i.scale||(sonic_scale_add(e,i.config),i.scale=e.findOne("scale",{dataKey:i.config.dataKey}),i.config.scaleId=i.scale.id())),"ordinal"!==i.scale.type()&&sonic.isSet(i.config.min)&&i.scale.domain()[0]!==i.config.min&&(i.domainMin=i.config.min,delete i.config.min,i.scale.mergeConfig({min:i.domainMin}),i.scale.resetDomain(),e.refreshRegistry(n.id())),!sonic.isSet(i.config.range)||i.config.range[0]===i.scale.rangeInputs()[0]&&i.config.range[1]===i.scale.rangeInputs()[1]||(i.scale.range(i.config.range),e.refreshRegistry(n.id()))},i.drawLabel=function(){var e;e=d3.select(this).selectAll("text").data([1]),e.enter().append("text"),e.classed(i.config.id+" "+i.config.cls+" sonic-label",!0).attr("transform","rotate("+(i.config.label.rotate||0)+")").attr("x",i.config.label.x).attr("y",i.config.label.y).attr("dx",i.config.label.dx).attr("dy",i.config.label.dy).style("text-anchor",i.config.label.anchor).text(i.config.label.text)},i.computeLabelPosition=function(){sonic.isSet(i.config.label.anchor)||(i.config.label.anchor="middle"),"horiz"===i.config.orient&&(i.config.label.y="bottom"===i.config.pos?e.currentPadding()[i.config.pos]-i.config.label.dy-10:-1*e.currentPadding()[i.config.pos]-i.config.label.dy+10,i.config.label.x=i.scale.rangeExtent()/2+i.config.label.dx+i.scale.rangeMin(),isNaN(i.config.label.x)&&(i.config.label.x=e.body().width()/2)),"vert"===i.config.orient&&("left"===i.config.pos?0===e.currentPadding().left-i.minPad?(i.config.label.y=-1*(e.currentPadding()[i.config.pos]-10),"auto"!==e.padding().left&&(i.config.label.y+=i.config.label.dx)):i.config.label.y=-1*(i.minPad-i.config.label.dx-10):0===e.currentPadding().right-i.minPad?(i.config.label.y=e.currentPadding()[i.config.pos]-10,"auto"!==e.padding().right&&(i.config.label.y+=i.config.label.dx)):i.config.label.y=i.minPad-10-i.config.label.dx,i.config.label.x=-1*i.scale.rangeExtent()/2+i.config.label.dy-i.scale.rangeMin(),isNaN(i.config.label.x)&&(i.config.label.x=0),i.config.label.rotate=-90)},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),e.register("sonic-axis",n),n},sonic_axis_add=function(e,t){e.body().call(sonic.axis(e,t))},sonic_axis_addX=function(e,t){t=sonic.object.merge({dataKey:"x",cls:"x"},t),e.body().call(sonic.axis(e,t))},sonic_axis_addY=function(e,t){t=sonic.object.merge({dataKey:"y",cls:"y",pos:"left"},t),e.body().call(sonic.axis(e,t))},sonic_axis_update=function(e,t,n){e.find("sonic-axis",t).forEach(function(e){e.mergeConfig(n),e.update()})},sonic_axis_updateY=function(e,t,n){e.find("sonic-axis",sonic.object.merge({dataKey:"y"},t)).forEach(function(e){e.mergeConfig(n),e.update()})},sonic_axis_remove=function(e,t){e.remove("sonic-axis",t)},lt.add("addAxis",sonic_axis_add),lt.add("addXAxis",sonic_axis_addX),lt.add("addYAxis",sonic_axis_addY),lt.add("updateAxis",sonic_axis_update),lt.add("updateYAxis",sonic_axis_updateY),lt.add("removeAxis",sonic_axis_remove),sonic.heatmap=function(e,t){function n(t,o){var a,c=[i.config.cls,"sonic-heatmap-set",n.id()];i.selection=t,i.computeData(o||{}),i.setScales(),i.computeColors(),a=t.selectAll(c.join(".")).data(i.data,function(e){return e.key}),a.enter().insert("g",":first-child").classed(c.join(" "),!0),a.each(i.drawHeatmap),a.exit().remove(),i.config.zoom&&i.addZoom(o),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,config:{id:null,cls:"",x1DataKey:"x",x2DataKey:"x2",y1DataKey:"y",y2DataKey:"y2",zDataKey:"z",xScaleId:null,yScaleId:null,colorGradient:{},colorConfig:{colorRange:{defaultRange:["#FFFFFF","#F20C0C"]},valueRange:{},step:null},seriesKeys:null,seriesIndexes:null,opacity:1,interactive:!0,tooltip:{renderFn:null},zoom:!1}};return i.addZoom=function(t){e.addZoom(n.id(),{zoom:{opts:t,fn:i.zoomAction}},i.xScale,i.yScale)},i.zoomAction=function(e){n(i.selection,e)},i.computeData=function(t){i.data=[],t.remove||(i.data=sonic.clone(e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes)),i.data.forEach(function(e,t){e.index=t,e.values=e.values.filter(function(e){return i.xScale&&i.yScale&&i.config.zoom?(e[i.config.x1DataKey]<i.xScale.domain()[0]&&e[i.config.x2DataKey]>i.xScale.domain()[0]&&(e[i.config.x1DataKey]=i.xScale.domain()[0]),e[i.config.x1DataKey]<i.xScale.domain()[1]&&e[i.config.x2DataKey]>i.xScale.domain()[1]&&(e[i.config.x2DataKey]=i.xScale.domain()[1]),e[i.config.y1DataKey]<i.yScale.domain()[0]&&e[i.config.y2DataKey]>i.yScale.domain()[0]&&(e[i.config.y1DataKey]=i.yScale.domain()[0]),e[i.config.y1DataKey]<i.yScale.domain()[1]&&e[i.config.y2DataKey]>i.yScale.domain()[1]&&(e[i.config.y2DataKey]=i.yScale.domain()[1]),!(e[i.config.x1DataKey]<i.xScale.domain()[0]||e[i.config.x2DataKey]>i.xScale.domain()[1]||e[i.config.y1DataKey]<i.yScale.domain()[0]||e[i.config.y2DataKey]>i.yScale.domain()[1])):!0})}))},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.x1DataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.y1DataKey}),i.config.yScaleId=i.yScale.id())},i.computeColors=function(){i.config.colorGradient={},i.data.forEach(function(e){var t,n,o=d3.max(e.values,function(e){return e[i.config.zDataKey]}),a=d3.min(e.values,function(e){return e[i.config.zDataKey]});n=i.config.colorConfig.colorRange[e.key]?i.config.colorConfig.colorRange[e.key]:i.config.colorConfig.colorRange.defaultRange,t=i.config.colorConfig.valueRange[e.key]?i.config.colorConfig.valueRange[e.key]:d3.range(a,o+(o-a)/n.length,(o-a)/(n.length-1)),i.config.colorGradient[e.key]=sonic.colors.generateGradient(n,t,i.config.colorConfig.step)})},i.drawHeatmap=function(t){var n,o=t.values;n=d3.select(this).selectAll(".sonic-heattile").data(o,function(e){var t,n;return t=e.bin?e.bin:e[i.config.x1DataKey]+"_"+e[i.config.x2DataKey],n=e.bin2?e.bin2:e[i.config.y1DataKey]+"_"+e[i.config.y2DataKey],t+"_"+n}),n.enter().append("rect").classed("sonic-heattile",!0).style("stroke-width",0).attr("x",function(e){return(i.xScale.position(e[i.config.x1DataKey])+i.xScale.position(e[i.config.x2DataKey]))/2}).attr("y",function(e){return(i.yScale.position(e[i.config.y2DataKey])+i.yScale.position(e[i.config.y1DataKey]))/2}).attr("height",0).attr("width",0),n.transition().delay(e.animation().delay).duration(e.animation().duration).attr("x",function(e){return i.xScale.position(e[i.config.x1DataKey])}).attr("y",function(e){return i.yScale.position(e[i.config.y2DataKey])}).attr("width",function(e){return i.xScale.position(e[i.config.x2DataKey])-i.xScale.position(e[i.config.x1DataKey])}).attr("height",function(e){return i.yScale.position(e[i.config.y1DataKey])-i.yScale.position(e[i.config.y2DataKey])}).attr("fill",function(e){return e.color||""+i.config.colorGradient[t.key].getColor(e[i.config.zDataKey])}).attr("fill-opacity",function(e){return e.opacity||i.config.opacity}),n.exit().remove()},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),i.selection.selectAll(".sonic-heattile").attr("fill",function(e){var n;return n=i.config.interactive&&t&&t.point===e?""+i.config.colorGradient[t.key].getColor(e[i.config.zDataKey]).brighter():t?""+i.config.colorGradient[t.key].getColor(e[i.config.zDataKey]):d3.select(this).attr("fill")}),t},i.closestPoints=function(e){var t=e[0],n=e[1],o=null;return i.data.forEach(function(e){e.values.forEach(function(a){var c=Math.abs(i.xScale.position(a[i.config.x1DataKey])),r=Math.abs(i.xScale.position(a[i.config.x2DataKey])),l=Math.abs(i.yScale.position(a[i.config.y2DataKey])),s=Math.abs(i.yScale.position(a[i.config.y1DataKey]));t>=c&&r>=t&&n>=l&&s>=n&&(o={point:a,key:e.key})})}),o},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-heatmap",n),n},lt.add("addHeat",y),lt.add("updateHeat",p),sonic.point=function(e,t){function n(t,o){var a,c=[i.config.cls,"sonic-point-set",n.id()];i.selection=t,i.computeData(),i.setScales(),a=t.selectAll(c.join(".")).data(i.data,function(e){return e.key}),a.enter().append("g").classed(c.join(" "),!0),a.each(i.drawPoints),a.each(i.setupLegend),a.exit().remove(),i.config.zoom&&i.addZoom(o),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,defaultColors:sonic.colors.colorMap(),config:{id:null,cls:"",definedDataKey:"id",xDataKey:"x",yDataKey:"y",xScaleId:null,yScaleId:null,seriesKeys:null,seriesIndexes:null,stroke:"",strokeWidth:1,fill:"",symbol:"circle",size:64,highlightSizeScale:2,fillOpacity:1,closestPointBy:null,standardLabel:{dx:-1,dy:1,show:!1,labelGenFn:function(e){return e.id}},highlightLabel:{dx:-3.5,dy:3.3,show:!1,textColor:"#000000",bkgrdColor:"#ffffff",labelGenFn:function(e){return e.id}},tooltip:{buffer:{type:"value",amount:null},renderFn:null},zoom:!1}};return i.addZoom=function(t){e.addZoom(n.id(),{zoom:{opts:t,fn:i.zoomAction}},i.xScale,i.yScale)},i.zoomAction=function(e){n(i.selection,e)},i.computeData=function(t){t=t||{},i.data=[],t.remove||(i.data=sonic.clone(e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes)),i.data.forEach(function(e,t){e.index=t,e.values=e.values.filter(function(e){return i.xScale&&i.yScale&&i.config.zoom?!(e[i.config.xDataKey]<i.xScale.domain()[0]||e[i.config.xDataKey]>i.xScale.domain()[1]||e[i.config.yDataKey]<i.yScale.domain()[0]||e[i.config.yDataKey]>i.yScale.domain()[1]):!0})}))},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id())},i.computeColor=function(e,t,n,o){return o&&e.stroke||e.color||n.color||i.defaultColors(n.index)},i.symbolGenerator=function(e){return d3.svg.symbol().type(function(e){return e.type||i.config.type}).size(function(t){var n=t.size||i.config.size;return i.isClosestPoint(t,e)&&(n*=i.config.highlightSizeScale),n})},i.drawPoints=function(t){var o,a=[],c=i.symbolGenerator();a=t.values,o=d3.select(this).selectAll(".sonic-point").data(a,function(e){return e[i.config.definedDataKey]}),o.enter().append("path").classed(n.id()+" sonic-point",!0).attr("fill-opacity",function(e){return sonic.isSet(e.fillOpacity)?e.fillOpacity:i.config.fillOpacity}).style("opacity",function(e){return sonic.isSet(e.opacity)?e.opacity:1}).attr("d","M0,0"),o.attr("d",c).transition().delay(e.animation().delay).duration(e.animation().duration).attr("transform",function(e){return"translate("+i.xScale.position(e[i.config.xDataKey])+","+i.yScale.position(e[i.config.yDataKey])+")"}).attr("stroke",function(e,n){return i.computeColor.call(this,e,n,t,!0)}).attr("stroke-width",function(e){return e.strokeWidth||i.config.strokeWidth}).attr("fill",function(e,n){return i.computeColor.call(this,e,n,t)}).attr("fill-opacity",function(e){return sonic.isSet(e.fillOpacity)?e.fillOpacity:i.config.fillOpacity}).style("opacity",function(e){return sonic.isSet(e.opacity)?e.opacity:1}),o.sort(function(e,t){return e.selected&&!t.selected?1:!e.selected&&t.selected?-1:0}),o.exit().remove()},i.setupLegend=function(e){d3.select(this).selectAll("path").attr(n.id()+"-data-legend",function(){return e.name||e.key})},i.drawLabel=function(e,t){var o;o=d3.select(this).selectAll(".symLabel").data(e,function(e){return e.point[i.config.definedDataKey]}),o.enter().append("text").classed(n.id()+" symLabel",!0),o.attr("transform",function(e){return"translate("+i.xScale.position(e.point[i.config.xDataKey])+","+i.yScale.position(e.point[i.config.yDataKey])+")"}).attr("dx",function(e){return i.config[t].dx*(""+e.point.markerId).length}).attr("dy",i.config[t].dy).text(function(e){return i.config[t].labelGenFn(e.point)}).style("fill",function(){return i.config.highlightLabel.textColor}),o.exit().remove()},i.onVizMouseMove=function(e){var t,o,a;return e&&(t=i.closestPoints(e)),a=i.symbolGenerator(t),i.updateTooltips(e,t),o=d3.selectAll("."+n.id()+".sonic-point-set").selectAll("."+n.id()+" .sonic-point"),o.sort(function(e,n){return i.isClosestPoint(e,t)?1:i.isClosestPoint(n,t)?-1:0}).attr("fill",function(e,n){var o,a=d3.select(this.parentElement).data()[0];return o=i.computeColor.call(this,e,n,a),i.isClosestPoint(e,t)&&(o=i.config.highlightLabel.show?i.config.highlightLabel.bkgrdColor:""+d3.rgb(o).brighter().brighter()),o}).attr("d",a),i.config.highlightLabel.show&&(t?o.forEach(function(e,n){i.drawLabel.call(e.parentNode,[t[n]],"highlightLabel")},this):d3.selectAll(".symLabel").remove()),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),i.selection.selectAll(".sonic-point").classed("selected",function(e){return i.isClosestPoint(e,t)}),t},i.closestPoints=function(e){var t,n,o,a=e[0],c=e[1];if(sonic.isSet(i.config.tooltip)&&sonic.isSet(i.config.tooltip.buffer)&&sonic.isSet(i.config.tooltip.buffer.value)===!0){if(n=c>=i.yScale.rangeMin()&&i.yScale.rangeMax()>=c,n===!1)return[]}else o=!0;return n||o?(t=i.data.map(function(e){return{key:e.key,dist:null,point:null}}),i.data.forEach(function(e,n){e.values.forEach(function(e){var o,r,l;r=Math.abs(i.xScale.position(e[i.config.xDataKey],"center")-a),l=Math.abs(i.yScale.position(e[i.config.yDataKey],"center")-c),o="x"===i.config.closestPointBy?r:"y"===i.config.closestPointBy?l:sonic.geom.pythagorize(r,l),(!t[n].point||t[n].dist>o)&&i.pointWithinBuffer(e,o)&&(t[n].point=e,t[n].dist=o)})}),t=t.filter(function(e){return sonic.isSet(e.point)?!0:!1})):void 0},i.isClosestPoint=function(e,t){return sonic.isArray(t)?t.filter(function(t){return t.point[i.config.definedDataKey]===e[i.config.definedDataKey]}).length>0:!1},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(i.config.tooltip.associatedId=n.id(),t?o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.removeTooltip(i.config.tooltip):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+":</b>"+t.point[i.config.yDataKey],n+"</p>"}).reduce(function(e,t){return e+t})},i.pointWithinBuffer=function(e,t){var n=!0,o=Math.sqrt(e.size||i.config.size)/2;return sonic.isSet(i.config.tooltip)&&sonic.isSet(i.config.tooltip.buffer)&&sonic.isSet(i.config.tooltip.buffer.amount)?"value"===i.config.tooltip.buffer.type?i.xScale.domainRangeToInterval(t)>i.config.tooltip.buffer.amount&&(n=!1):t>i.config.tooltip.buffer.amount&&(n=!1):sonic.isSet(i.config.tooltip)&&sonic.isSet(i.config.tooltip.buffer)&&"radius"===i.config.tooltip.buffer.type&&t>o&&(n=!1),n},n.updatePoint=function(t){var n,o=i.selection.selectAll(".sonic-point").filter(function(e){return e.id===t.id}),a=i.symbolGenerator();o.data().forEach(function(e){sonic.object.merge(e,t)}),e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes).forEach(function(e){n=e,e.values.filter(function(e){return e.id===t.id}).forEach(function(e){sonic.object.merge(e,t)})}),o.attr("d",a).transition().delay(e.animation().delay).duration(e.animation().duration).attr("transform",function(e){return"translate("+i.xScale.position(e[i.config.xDataKey])+","+i.yScale.position(e[i.config.yDataKey])+")"}).attr("stroke",function(e,t){return i.computeColor.call(this,e,t,n,!0)}).attr("stroke-width",function(e){return e.strokeWidth||i.config.strokeWidth}).attr("fill",function(e,t){return i.computeColor.call(this,e,t,n)}).attr("fill-opacity",function(e){return sonic.isSet(e.fillOpacity)?e.fillOpacity:i.config.fillOpacity}).style("opacity",function(e){return sonic.isSet(e.opacity)?e.opacity:1})},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-point",n),n},lt.add("addPoint",h),lt.add("addPoints",h),lt.add("updatePoint",S),lt.add("updatePoints",S),lt.add("removePoint",m),lt.add("removePoints",m),lt.add("updateSinglePoint",x),sonic.network=function(e,t){function n(t,o){var a;[i.config.cls,"sonic-network"],i.selection=t,i.setupNetworkLayout(),i.computeData(o||{}),a=i.selection.selectAll(".sonic-network."+n.id()).data([1]),a.enter().append("g").classed("sonic-network "+n.id(),!0),a.each(i.drawNetwork),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={network:d3.layout.force(),nodeToLinkMap:{},colorGradient:null,config:{type:"sonic-network",cls:"",nodeIdKey:"id",nodeDisplayKey:"name",nodeGroupKey:"group",nodeCircleRadiusKey:"radius",nodeFillKey:"fill",nodeImageKey:"image",nodeImageHighlightKey:"highlightImage",nodeImageWidthKey:"width",nodeImageHeightKey:"height",layoutOpts:{size:[.8*e.body().height(),.8*e.body().width()]},linkStyle:{opacity:1,strokeWidth:2,highlightStrokeWidthGrowth:2,highlightStrokeColor:"#CCCCCC",stroke:"#CCCCCC",showDirections:!0,gradient:null},nodeStyle:{opacity:.7,strokeWidth:2,colorBy:"depth",nodeColors:sonic.colors.colorMap(),radius:5,highlightRadiusGrowth:3,label:{fill:"#555",fontFamiy:"arial",fontSize:"12px",anchor:"middle"},range:null},tooltip:{buffer:{type:"value",amount:null}},networkForce:{gravity:.05,distance:100,charge:-100}}};return n.hasContent=sonic.override(function(){return i.data.nodes&&i.data.nodes.length>0}),i.setupNetworkLayout=function(){var e=i.calcLayoutSize();i.network.size(e)},i.calcLayoutSize=function(){var e=i.config.layoutOpts.size;return e=t&&t.layoutOpts&&t.layoutOpts.size?t.layoutOpts.size:i.calcLayoutLinear()},i.calcLayoutLinear=function(){return[i.calcHeight(),i.calcWidth()]},i.calcWidth=function(){return.8*e.body().width()},i.calcHeight=function(){return.8*e.body().height()},i.computeData=function(t){var n,o,a=e.data()[0].values,c=null,r=null,l=i.selection.selectAll(".node");i.colorGradient=null,i.nodeToLinkMap={},i.data={nodes:[],links:[]},t.remove||(e.data()[0]&&e.data()[0].values&&(i.data.nodes=e.data()[0].values),e.data()[1]&&e.data()[1].values&&(i.data.links=e.data()[1].values,i.data.links.forEach(function(e){for(n=0;i.data.nodes.length>n;n++)i.data.nodes[n][i.config.nodeIdKey]===e.source&&(e.source=i.data.nodes[n]);for(o=0;i.data.nodes.length>o;o++)i.data.nodes[o][i.config.nodeIdKey]===e.target&&(e.target=i.data.nodes[o]);i.nodeToLinkMap[e.source[i.config.nodeIdKey]]||(i.nodeToLinkMap[e.source[i.config.nodeIdKey]]=[]),i.nodeToLinkMap[e.target[i.config.nodeIdKey]]||(i.nodeToLinkMap[e.target[i.config.nodeIdKey]]=[]),i.nodeToLinkMap[e.source[i.config.nodeIdKey]].push(e),i.nodeToLinkMap[e.target[i.config.nodeIdKey]].push(e),(!sonic.isSet(c)||e.weight>c)&&(c=e.weight),(!sonic.isSet(r)||r>e.weight)&&(r=e.weight)})),i.data.nodes.forEach(function(e){e.links=i.nodeToLinkMap[e[i.config.nodeIdKey]],i.config.persistMove&&i.persistMove(e,l)}),sonic.isSet(i.config.linkStyle.gradient)&&(i.colorGradient=0>r*c?sonic.colors.generateGradient(i.config.linkStyle.gradient,[r,0,c]):sonic.colors.generateGradient(i.config.linkStyle.gradient,[r,c])),i.config.nodeStyle.range&&(i.dataMin=d3.min(a,function(e){return e[i.config.nodeCircleRadiusKey]}),i.dataMax=d3.max(a,function(e){return e[i.config.nodeCircleRadiusKey]})))},i.persistMove=function(e,t){t.each(function(t){e[i.config.nodeIdKey]===t[i.config.nodeIdKey]&&t.moved===!0&&(e.x=e.pinX||t.x,e.y=e.pinY||t.y,e.moved=!e.pinX,e.fixed=!e.pinY)})},i.drawNetwork=function(){var t,n;i.network.gravity(i.config.networkForce.gravity).distance(i.config.networkForce.distance).charge(i.config.networkForce.charge).size([i.calcWidth(),i.calcHeight()]).nodes(i.data.nodes).links(i.data.links).start(),t=i.addLinks.apply(this),n=i.addNodes.apply(this),i.network.on("tick",function(){n.attr("transform",function(t){return sonic.isSet(t.locationOffset)&&!t.moved&&(t.x=e.body().width()/2+e.body().width()/2*t.locationOffset.x,t.y=e.body().height()/2+e.body().height()/2*t.locationOffset.y),sonic.isSet(t.pinX)&&!t.moved&&(t.x=t.pinX),sonic.isSet(t.pinY)&&!t.moved&&(t.y=t.pinY),0>t.x?t.x=0:t.x>e.body().width()&&(t.x=e.body().width()),0>t.y?t.y=0:t.y>e.body().height()&&(t.y=e.body().height()),"translate("+t.x+","+t.y+")"}),t.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})})},i.addLinks=function(){var e,t;return d3.select(this).append("g").attr("id","links"),e=d3.select("#links").selectAll(".link").data(i.network.links(),function(e){return e.source[i.config.nodeIdKey]+"_"+e.target[i.config.nodeIdKey]}),t=e.enter().append("line").classed("link",!0),e.style("stroke",function(e){return sonic.isSet(i.colorGradient)?""+i.colorGradient.getColor(e.weight):e.stroke||e.color||i.config.linkStyle.stroke}).style("stroke-width",function(){return i.config.linkStyle.strokeWidth}),e.exit().remove(),e},i.addNodes=function(){var e,t,n;return n=i.network.drag().on("dragstart",i.dragstart),e=d3.select(this).selectAll(".node").data(i.data.nodes,function(e){return parseInt(e[i.config.nodeIdKey],10)}),t=e.enter().append("g").classed("node",!0).classed("fixed",function(e){return sonic.isSet(e.locationOffset)||sonic.isSet(e.pinX)&&sonic.isSet(e.pinY)?(e.fixed=!0,!0):!1}),e.call(n),t.append("circle"),e.selectAll("g circle").attr("r",function(e){var t=i.calcNodeSize(e);return t.height&&t.width?0:t}).style("fill",function(e){return i.getNodeColor.call(this,e)}).style("fill-opacity",i.config.nodeStyle.opacity).style("stroke",function(e){return d3.rgb(i.getNodeColor.call(this,e)).darker()}).style("stroke-width",i.config.nodeStyle.strokeWidth),t.append("image"),e.selectAll("g image").attr("xlink:href",function(){return i.getNodeImage.apply(this,arguments)}).attr("y",function(e){var t=i.calcNodeSize(e);return t.height?-1*t.height/2:-10}).attr("x",function(e){var t=i.calcNodeSize(e);return t.width?-1*t.width/2:-10}).attr("width",function(e){var t=i.calcNodeSize(e);return t.width?t.width:16}).attr("height",function(e){var t=i.calcNodeSize(e);return t.height?t.height:16}),i.config.nodeStyle.label&&(t.append("text"),e.selectAll("g text").attr("dx",function(){return i.config.nodeStyle.label.dx||0}).attr("dy",function(e){if(i.config.nodeStyle.label.dy)return i.config.nodeStyle.label.dy;var t=i.calcNodeSize(e);return t.height&&t.width?-1*t.height/2-5:-1*t-5}).style("fill",i.config.nodeStyle.label.fill).style("stroke","none").style("font-size",i.config.nodeStyle.label.fontSize).style("font-family",i.config.nodeStyle.label.fontFamily).style("text-anchor",i.config.nodeStyle.label.anchor).text(function(e){return e[i.config.nodeDisplayKey]})),e.exit().remove(),e},i.dragstart=function(e){e.fixed=!0,e.moved=!0,d3.select(this).classed("fixed",!0)},i.dragstop=function(e){e.dragging=!1},i.calcNodeSize=function(e){if(e&&e[i.config.nodeImageKey]&&sonic.isSet(e[i.config.nodeImageHeightKey])&&sonic.isSet(e[i.config.nodeImageWidthKey]))return{height:e[i.config.nodeImageHeightKey],width:e[i.config.nodeImageWidthKey]};if(e&&sonic.isSet(e[i.config.nodeCircleRadiusKey])){var t,n=i.config.nodeStyle.range;return n?(t=(e[i.config.nodeCircleRadiusKey]-i.dataMin)/(i.dataMax-i.dataMin),(n[1]-n[0])*t+n[0]):e[i.config.nodeCircleRadiusKey]}return i.config.nodeStyle.radius},i.getNodeColor=function(e){var t=e.color;return t||(t="depth"===i.config.nodeStyle.colorBy?i.config.nodeStyle.nodeColors(e.depth):i.config.nodeStyle.nodeColors(e[i.config.nodeGroupKey])),sonic.svg.hasClass(this,"selected")&&(t=""+d3.rgb(t).darker()),t},i.getNodeImage=function(e){var t;return e[i.config.nodeImageKey]&&(t=e[i.config.nodeImageKey]),sonic.svg.hasClass(this,"selected")&&e[i.config.nodeImageHighlightKey]&&(t=e[i.config.nodeImageHighlightKey]),t},i.closestPoints=function(e){var t,n=i.getClosestPoints(i.data,e);if(t=i.calcNodeSize(n[0]),t.height&&t.width){if(n[1]<Math.max(t.height,t.width))return n}else if(t>n[1])return n;return[]},i.isClosestPoint=function(e,t){var n=!1;return t&&t.forEach(function(t){t&&t[i.config.nodeIdKey]===e[i.config.nodeIdKey]&&(n=!0)}),n},i.getClosestPoints=function(e,t){var n=[null,null];return e.nodes&&e.nodes.forEach(function(e){var i=Math.sqrt(Math.pow(t[0]-e.x,2)+Math.pow(t[1]-e.y,2));(!n[1]||n[1]>i)&&(n=[e,i])}),n},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),i.selection.selectAll(".sonic-network."+n.id()+" g circle").classed("selected",function(e){return i.isClosestPoint(e,t)}).style("fill",function(){return i.getNodeColor.apply(this,arguments)}).style("stroke",function(){return d3.rgb(i.getNodeColor.apply(this,arguments)).darker()}),i.selection.selectAll(".sonic-network."+n.id()+" g image").classed("selected",function(e){return i.isClosestPoint(e,t)}).attr("xlink:href",function(){return i.getNodeImage.apply(this,arguments)}),t},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),i.selection.selectAll(".sonic-network."+n.id()+" g circle:not(.selected)").style("fill",function(e){var n=i.getNodeColor.apply(this,arguments);return i.isClosestPoint(e,t)?d3.rgb(n).brighter():n}).style("stroke",function(e){var n=i.getNodeColor.apply(this,arguments);return n=d3.rgb(n).darker(),i.isClosestPoint(e,t)?d3.rgb(n).brighter():n}),i.selection.selectAll(".sonic-network."+n.id()+" g image:not(.selected)").attr("xlink:href",function(e){return i.isClosestPoint(e,t)&&e[i.config.nodeImageHighlightKey]?e[i.config.nodeImageHighlightKey]:i.getNodeImage.apply(this,arguments)}),i.selection.selectAll(".sonic-network."+n.id()+" line").style("stroke-width",function(e){var n=i.config.linkStyle.strokeWidth;return t&&t.length>0&&t[0][i.config.nodeIdKey]===e.source[i.config.nodeIdKey]||t&&t.length>0&&t[0][i.config.nodeIdKey]===e.target[i.config.nodeIdKey]?n+i.config.linkStyle.highlightStrokeWidthGrowth:n}).style("stroke",function(e){return t&&t.length>0&&t[0][i.config.nodeIdKey]===e.source[i.config.nodeIdKey]||t&&t.length>0&&t[0][i.config.nodeIdKey]===e.target[i.config.nodeIdKey]?i.config.linkStyle.highlightStrokeColor:sonic.isSet(i.colorGradient)?""+i.colorGradient.getColor(e.weight):e.stroke||e.color||i.config.linkStyle.stroke}),t},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.config.tooltip.renderFn=function(e){var t,n="";return t=e[0].name,n="<b>"+t+"</b>"},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-network",n),n},lt.add("addNetwork",v),lt.add("updateNetwork",k),lt.add("removeNetwork",b),sonic.tree=function(e,t){function n(e,t){var o;[i.config.cls,"sonic-network"],i.selection=e,i.setupTreeLayout(),i.computeData(t||{}),o=i.selection.selectAll(".sonic-tree."+n.id()).data([1]),o.enter().append("g").classed("sonic-tree "+n.id(),!0),o.each(i.drawTree),o.exit().remove()}var i={tree:d3.layout.tree(),config:{type:"sonic-tree",cls:"",nodeIdKey:"id",nodeDisplayKey:"name",nodeGroupKey:"group",nodeSizeKey:"radius",nodeFillKey:"fill",childrenKey:"children",verticalTree:!0,collapsible:!1,layoutOpts:{size:[.8*e.body().height(),.8*e.body().width()],separation:function(e,t){return(e.parent===t.parent?1:2)/e.depth},linkPathGenerator:d3.svg.diagonal().projection(function(e){return i.config.verticalTree?[e.x,e.y]:[e.y,e.x]})},linkStyle:{opacity:1,strokeWidth:2,highlightStrokeWidthGrowth:2,stroke:"#CCCCCC",highlightStrokeChange:"darker",showDirections:!0},nodeStyle:{opacity:.7,strokeWidth:2,colorBy:"depth",nodeColors:d3.scale.category20(),radius:5,highlightRadiusGrowth:3,highlightStrokeChange:"brighter",highlightFillChange:"brighter",collapsedFillColor:"#fff",labelNode:!1,label:{fill:"#555",fontFamiy:"arial",fontSize:"12px",anchor:"middle"}},tooltip:{buffer:{type:"value",amount:null}}}};return i.setupTreeLayout=function(){var e=i.calcLayoutSize();i.tree.size(e)},i.calcLayoutSize=function(){var e=i.config.layoutOpts.size;return e=t&&t.layoutOpts&&t.layoutOpts.size?t.layoutOpts.size:i.calcLayoutLinear()},i.calcLayoutLinear=function(){return[.8*e.body().height(),.8*e.body().width()]},i.computeData=function(t){t.remove&&(i.data={}),i.data=e.data()[0].values[0]},i.drawTree=function(){var e,t;e=i.config.verticalTree?i.tree.nodes(i.data):i.tree.nodes(i.data).reverse(),t=i.tree.links(e),i.drawNode.call(this,e,i.data),i.drawLink.call(this,t,i.data)},i.drawLink=function(t,n){var o=d3.select(this).selectAll("path.link").data(t,function(e){return e.target.id});o.enter().insert("path","g").attr("class","link").attr("d",function(){var e={x:n.x0,y:n.y0};return i.config.layoutOpts.linkPathGenerator({source:e,target:e})}).style("stroke",function(e){return e.color||i.config.linkStyle.stroke}).style("stroke-width",function(){return i.config.linkStyle.strokeWidth}).style("fill","none"),o.transition().duration(e.animation().duration).attr("d",i.config.layoutOpts.linkPathGenerator),o.exit().transition().duration(e.animation().duration).attr("d",function(){var e={x:n.x,y:n.y};return i.config.layoutOpts.linkPathGenerator({source:e,target:e})}).remove()},i.drawNode=function(t,n){var o,a,c,r;o=d3.select(this).selectAll("g.node").data(t,function(e){return e[i.config.nodeIdKey]}),a=o.enter().append("g").attr("class","node").attr("transform",function(){return i.config.verticalTree?"translate("+n.x0+","+n.y0+")":"translate("+n.y0+","+n.x0+")"}).on("dblclick",i.onNodeDoubleClicked),a.append("circle").style("stroke",function(){return"#fff"}).style("stroke-width",i.config.nodeStyle.strokeWidth).style("fill-opacity",i.config.nodeStyle.opacity).attr("r",1e-6),a.append("text").attr("dy","4px").attr("dx",function(e){var t=i.getNodeRadius(e);return t+3+"px"}).attr("text-anchor",function(){return"start"}).style("fill-opacity",1e-6).style("font","4px sans-serif").text(function(e){return e[i.config.nodeDisplayKey]||""}),c=o.transition().duration(e.animation().duration).attr("transform",function(e){return i.config.verticalTree?"translate("+e.x+","+e.y+")":"translate("+e.y+","+e.x+")"}),c.select("circle").attr("r",function(e){return i.getNodeRadius(e)}).style("stroke",function(){var e=i.getNodeColor.apply(this,arguments);return d3.rgb(e).darker()}).style("fill",function(e){var t=i.getNodeColor.apply(this,arguments);return i.config.collapsible&&e._children&&(t=i.config.nodeStyle.collapsedFillColor),t}),c.select("text").style("fill-opacity",1).style("font","10px sans-serif"),r=o.exit().transition().duration(e.animation().duration).attr("transform",function(){return i.config.verticalTree?"translate("+n.x+","+n.y+")":"translate("+n.y+","+n.x+")"}).remove(),r.select("circle").attr("r",1e-6),r.select("text").style("fill-opacity",1e-6),t.forEach(function(e){e.x0=e.x,e.y0=e.y
})},i.getNodeRadius=function(e){var t;return t=e[i.config.nodeSizeKey]?e[i.config.nodeSizeKey]:i.config.nodeStyle.radius},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),e&&(i.selection.selectAll(".sonic-tree."+n.id()+" circle:not(.selected)").style("fill",function(e){var n=i.getNodeColor.apply(this,arguments);return i.config.collapsible&&e._children&&(n=i.config.nodeStyle.collapsedFillColor),i.isClosestPoint(e,t)?d3.rgb(n).brighter():n}).style("stroke",function(e){var n=i.getNodeColor.apply(this,arguments);return n=d3.rgb(n).darker(),i.isClosestPoint(e,t)?d3.rgb(n).brighter():n}).attr("r",function(e){var n=i.getNodeRadius(e);return i.isClosestPoint(e,t)?n+i.config.nodeStyle.highlightRadiusGrowth:n}),i.selection.selectAll(".sonic-tree."+n.id()+" path").style("stroke-width",function(e){var n=i.config.linkStyle.strokeWidth;return t.length>0&&t[0][i.config.nodeIdKey]===e.source[i.config.nodeIdKey]||t.length>0&&t[0][i.config.nodeIdKey]===e.target[i.config.nodeIdKey]?n+i.config.linkStyle.highlightStrokeWidthGrowth:n})),t},i.getNodeColor=function(e){var t=e.color;return t||(t="depth"===i.config.nodeStyle.colorBy?i.config.nodeStyle.nodeColors(e.depth):i.config.nodeStyle.nodeColors(e.group)),sonic.svg.hasClass(this,"selected")&&(t=""+d3.rgb(t).darker()),t},i.closestPoints=function(e){var t,n=i.getClosestPoints(i.data,e);return t=i.getNodeRadius(n[0]),t>n[1]?n:[]},i.isClosestPoint=function(e,t){var n=!1;return t.forEach(function(t){t&&t[i.config.nodeIdKey]===e[i.config.nodeIdKey]&&(n=!0)}),n},i.getClosestPoints=function(e,t){var n,o;return n=i.config.verticalTree?Math.sqrt(Math.pow(t[0]-e.x,2)+Math.pow(t[1]-e.y,2)):Math.sqrt(Math.pow(t[0]-e.y,2)+Math.pow(t[1]-e.x,2)),o=[e,n],e.children&&e.children.forEach(function(e){var n=i.getClosestPoints(e,t);n[1]<o[1]&&(o=n)}),o},i.onNodeDoubleClicked=function(t){i.config.collapsible&&t&&(t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),e.update())},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),i.selection.selectAll(".sonic-tree."+n.id()+" circle").classed("selected",function(e){return i.isClosestPoint(e,t)}).style("fill",function(e){var t=i.getNodeColor.apply(this,arguments);return i.config.collapsible&&e._children&&(t=i.config.nodeStyle.collapsedFillColor),t}).style("stroke",function(){return d3.rgb(i.getNodeColor.apply(this,arguments)).darker()}),t},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.config.tooltip.renderFn=function(e){var t,n,i="";return t=e[0].name,n=e[0].children||[],i="<p><b>"+t+":</b><br/>"+"<b>Children:</b><br/>",n.forEach(function(e){t=e.name,i=i+"<b>"+t+"</b><br/>"}),i},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-tree",n),n},lt.add("addTree",K),lt.add("updateTree",w),lt.add("removeTree",D),sonic.boxAndWhisker=function(e,t){function n(e,t){var o;[i.config.cls,"line"],i.selection=e,i.computeData(t||{}),i.setScales(),o=e.selectAll(".sonic-box-and-whisker."+n.id()).data([i.data]),o.enter().append("g").classed("sonic-box-and-whisker "+n.id(),!0),o.each(i.drawBox),o.each(i.drawMedian),o.each(i.drawWhiskers),o.each(i.drawCurrentPoint),o.exit().remove()}var i={xScale:null,yScale:null,config:{id:null,cls:"",xScaleId:null,yScaleId:null,seriesKeys:null,seriesIndexes:null,valueKey:"value",currentPoint:{val:null},boxStyle:{fill:"#FA8E46",stroke:"#FA8E46",strokeWidth:2,fillOpacity:.6},whiskerStyle:{stroke:"#FA8E46",strokeWidth:1},medianStyle:{stroke:"#E00707",strokeWidth:2},currentPointStyle:{fill:"#3DDDF2",fillOpacity:.8,stroke:"#3DDDF2",strokeWidth:2,type:"diamond",size:50},sortFn:function(e,t){return t>e?-1:e>t?1:0},tooltip:{type:"global",renderFn:function(e){return"<p><b>Min Outlier: </b>"+e[0].min+"<br/>"+"<b>1st Quartile: </b>"+e[0].q1+"<br/>"+"<b>Median: </b>"+e[0].q2+"<br/>"+"<b>3rd Quartile: </b>"+e[0].q3+"<br/>"+"<b>Max Outlier: </b>"+e[0].max+"<br/>"+"<b>Current Point: </b>"+i.config.currentPoint.val+"<br/></p>"}}}};return i.computeData=function(t){var n=[];i.data=[],t.remove||(e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes).filter(function(e){return e.values.length>0?!0:void 0}).forEach(function(e){n=n.concat(e.values)}),n=n.map(function(e){return sonic.isSet(e[i.config.valueKey])?e[i.config.valueKey]:e}),n.sort(i.config.sortFn),i.computeQuartilesAndExtrema(n))},i.computeQuartilesAndExtrema=function(e){var t,n;i.data={min:null,max:null,q1:null,q2:null,q3:null},i.data.min=e[0],i.data.max=e[e.length-1],0===e.length%2?(i.data.q2=(e[e.length/2]+e[e.length/2-1])/2,t=e.slice(0,e.length/2),n=e.slice(e.length/2,e.length)):(i.data.q2=e[Math.floor(e.length/2)],t=e.slice(0,Math.floor(e.length/2)),n=e.slice(Math.ceil(e.length/2),e.length)),i.data.q1=0===t%2?(t[t.length/2]+t[t.length/2-1])/2:t[Math.floor(t.length/2)],i.data.q3=0===n%2?(n[n.length/2]+n[n.length/2-1])/2:n[Math.floor(n.length/2)]},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id())},i.drawBox=function(){var t=d3.select(this).selectAll("rect").data([i.data]);t.enter().append("rect"),t.transition().duration(e.animation().duration).delay(e.animation().delay).style("stroke-width",i.config.boxStyle.strokeWidth).style("stroke",i.config.boxStyle.stroke).style("fill",i.config.boxStyle.fill).style("fill-opacity",i.config.boxStyle.fillOpacity).attr("x",i.xScale.position(i.data.q1)).attr("y",i.yScale.position(1)).attr("height",i.yScale.position(0)-i.yScale.position(1)).attr("width",i.xScale.position(i.data.q3)-i.xScale.position(i.data.q1)),t.exit().remove()},i.drawMedian=function(){var t=d3.select(this).selectAll("line.median").data([i.data]);t.enter().append("line").classed("median",!0),t.transition().duration(e.animation().duration).delay(e.animation().delay).style("stroke",i.config.medianStyle.stroke).style("stroke-width",i.config.medianStyle.strokeWidth).attr("x1",i.xScale.position(i.data.q2)).attr("y1",i.yScale.position(0)).attr("x2",i.xScale.position(i.data.q2)).attr("y2",i.yScale.position(1)),t.exit().remove()},i.drawWhiskers=function(){var t,n,o=d3.select(this).selectAll("g.whiskers").data([i.data]);o.enter().append("g").classed("whiskers",!0),t=o.selectAll("line.left-whisker").data([i.data]),t.enter().append("line").classed("left-whisker",!0),n=o.selectAll("line.right-whisker").data([i.data]),n.enter().append("line").classed("right-whisker",!0),t.transition().duration(e.animation().duration).delay(e.animation().delay).style("stroke",i.config.whiskerStyle.stroke).style("stroke-width",i.config.whiskerStyle.strokeWidth).attr("x1",i.xScale.position(i.data.min)).attr("y1",i.yScale.position(.5)).attr("x2",i.xScale.position(i.data.q1)).attr("y2",i.yScale.position(.5)),n.transition().duration(e.animation().duration).delay(e.animation().delay).style("stroke",i.config.whiskerStyle.stroke).style("stroke-width",i.config.whiskerStyle.strokeWidth).attr("x1",i.xScale.position(i.data.q3)).attr("y1",i.yScale.position(.5)).attr("x2",i.xScale.position(i.data.max)).attr("y2",i.yScale.position(.5)),t.exit().remove(),n.exit().remove(),o.exit().remove()},i.symbolGenerator=function(){return d3.svg.symbol().type(function(e){return e.type||i.config.currentPointStyle.type}).size(function(e){var t=e.size||i.config.currentPointStyle.size;return t})},i.drawCurrentPoint=function(){var t=d3.select(this).selectAll("path.currentPoint").data([i.config.currentPointStyle]);t.enter().append("path").classed("currentPoint",!0).attr("d","M0,0"),t.transition().duration(e.animation().duration).delay(e.animation().delay).attr("transform","translate("+i.xScale.position(i.config.currentPoint.val)+","+i.yScale.position(.5)+")").attr("stroke",i.config.currentPointStyle.stroke).attr("stroke-width",i.config.currentPointStyle.strokeWidth).attr("fill",i.config.currentPointStyle.fill).attr("fill-opacity",i.config.currentPointStyle.fillOpacity).attr("d",i.symbolGenerator()),t.exit().remove()},i.onVizMouseMove=function(e){i.updateTooltips(e,[i.data])},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-box-and-whisker",n),n},lt.add("addBoxAndWhisker",P),lt.add("updateBoxAndWhisker",C),lt.add("removeBoxAndWhisker",I),sonic.line=function(e,t){function n(t,o){var a;[i.config.cls,"sonic-line"],i.selection=t,i.computeData(o||{}),i.setScales(),i.computeColors(),a=t.selectAll(".sonic-line."+i.config.id).data(i.data),a.enter().append("g").classed("sonic-line "+i.config.id,!0).append("path").attr("stroke-width",i.config.strokeWidth).attr("fill-opacity",0),a.attr("stroke",function(e,t){return i.colors[t]}).attr("fill",function(e,t){return i.colors[t]}),a.each(i.drawLine),a.each(i.drawPoints),a.each(i.drawTracerPoint),a.each(i.setupLegend),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,defaultColors:sonic.colors.colorMap(),colors:[],config:{id:null,cls:"",definedDataKey:"id",xDataKey:"x",yDataKey:"y",xScaleId:null,yScaleId:null,seriesKeys:null,seriesIndexes:null,stroke:"black",fill:"black",strokeWidth:3,fillOpacity:1,showPoints:!1,showPointTracer:!0,pointSize:4,highlightPointSize:6,minPixelsPerPoint:20,sort:!1,tooltip:{buffer:{type:"value",amount:null},type:"grouped",renderFn:null}}};return i.computeData=function(t){i.data=[],t.remove||(i.data=e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes).filter(function(e){return e.values.length>0?!0:void 0}))},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id())},i.computeColors=function(){i.data.forEach(function(e,t,n){i.colors[t]=n.length>1?e.color||i.defaultColors(t):e.color||i.config.stroke})},i.lineGenerator=function(){return d3.svg.line().defined(function(e){return sonic.isSet(e[i.config.definedDataKey])}).x(function(e){return i.xScale.position(e[i.config.xDataKey],"center")}).y(function(e){return i.yScale.position(e[i.config.yDataKey],"center")})},i.setupLegend=function(e){d3.select(this).selectAll("path").attr(n.id()+"-data-legend",function(){return e.name||e.key})},i.drawLine=function(t){var n=i.lineGenerator();d3.select(this).selectAll("path").data(i.data).transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(){var e=t.values;return i.config.sort&&(e=i.xScale.sort(e)),n(e)})},i.drawPoints=function(t){var n,o=[];i.config.showPoints&&i.config.minPixelsPerPoint<e.body().width()/t.values.length&&(o=t.values),n=d3.select(this).selectAll("circle.line-point").data(o),n.enter().append("circle").classed(i.config.id+" line-point",!0).attr("fill-opacity",i.config.fillOpacity),n.transition().delay(e.animation().delay).duration(e.animation().duration).attr("cx",function(e){return i.xScale.position(e[i.config.xDataKey],"center")}).attr("cy",function(e){return i.yScale.position(e[i.config.yDataKey],"center")}).attr("r",i.config.pointSize),n.exit().remove()},i.drawTracerPoint=function(e){var t,n=[];i.config.showPointTracer===!0?n.push({type:"mouse"},{type:"click"}):i.config.showTracerPoint!==!1&&n.push({type:i.config.showPointTracer}),t=d3.select(this).selectAll("circle.tracer-point").data(n),t.enter().append("circle").attr("class",function(t){return i.config.id+" "+e.key+" tracer-point "+t.type}).attr("fill-opacity",.8).attr("opacity",0).attr("r",i.config.highlightPointSize),t.attr("cx",function(){var t=this.getAttribute("cpId"),n=0,o=[];return t&&(o=e.values.filter(function(e){return sonic.isDate(e.id)?""+e.id.getTime()===t:""+e.id===t}),o.length>0&&(n=i.getPositionFromCP([{point:o[0]}],0)[0])),n}).attr("cy",function(){var t=this.getAttribute("cpId"),n=0,o=[];return t&&(o=e.values.filter(function(e){return sonic.isDate(e.id)?""+e.id.getTime()===t:""+e.id===t}),o.length>0&&(n=i.getPositionFromCP([{point:o[0]}],0)[1])),n}),t.exit().remove()},i.onVizMouseMove=function(e){var t=[];return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),d3.selectAll("."+n.id()+".tracer-point.mouse").attr("cx",function(e,n){var o=i.getPositionFromCP(t,n);return o?o[0]:0}).attr("cy",function(e,n){var o=i.getPositionFromCP(t,n);return o?o[1]:0}).attr("opacity",function(n,o){return e&&i.getPositionFromCP(t,o)?1:0}).attr("stroke",function(e,n){return t&&t[n]?t[n].color:null}).attr("fill",function(e,n){return t&&t[n]?t[n].color:null}),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),d3.selectAll("."+n.id()+".tracer-point.mouse").attr("opacity",0),d3.selectAll("."+n.id()+".tracer-point.click").attr("cx",function(e,n){var o=i.getPositionFromCP(t,n);return o?o[0]:0}).attr("cy",function(e,n){var o=i.getPositionFromCP(t,n);return o?o[1]:0}).attr("cpId",function(e,n){var i=null;return t&&t.length>0&&t[n]&&(i=sonic.isDate(t[n].point.id)?t[n].point.id.getTime():t[n].point.id),i}).attr("opacity",function(n,o){return e&&i.getPositionFromCP(t,o)?1:0}),t},i.closestPoints=function(e){var t,n,o=[],a=e[0],c=e[1];if(i.config.tooltip&&sonic.isSet(i.config.tooltip.buffer.value)===!0){if(t=c>=i.yScale.rangeMin()&&i.yScale.rangeMax()>=c,t===!1)return[]}else n=!0;return t||n?(o=i.data.map(function(e){var t={xDist:null,point:null};return sonic.each(e,function(e,n){"values"!==e&&(t[e]=n)}),t}),i.data.forEach(function(e,t){e.values.forEach(function(e){var n=Math.abs(i.xScale.position(e[i.config.xDataKey],"center")-a),r=Math.abs(i.yScale.position(e[i.config.yDataKey],"center")-c);(!o[t].point||o[t].xDist>n)&&i.pointWithinBuffer(e,n)&&(o[t].point=e,o[t].xDist=n,o[t].yDist=r)})}),o=o.filter(function(e){return sonic.isSet(e.point)?!0:!1})):void 0},i.updateTooltips=function(t,o){var a;i.config.tooltip&&(a=i.config.tooltip.renderFn||i.renderTooltips,i.config.tooltip.associatedId=n.id(),t?o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.removeTooltip(i.config.tooltip):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+":</b>"+t.point[i.config.yDataKey],n+"</p>"}).reduce(function(e,t){return e+t})},i.pointWithinBuffer=function(e,t){var n=!0;return i.config.tooltip&&sonic.isSet(i.config.tooltip.buffer.amount)&&("value"===i.config.tooltip.buffer.type?i.xScale.domainRangeToInterval(t)>i.config.tooltip.buffer.amount&&(n=!1):t>i.config.tooltip.buffer.amount&&(n=!1)),n},i.getPositionFromCP=function(e,t){return e&&e.length>0&&e[t]?[i.xScale.position(e[t].point[i.config.xDataKey],"center"),i.yScale.position(e[t].point[i.config.yDataKey])]:null},i.isClosestPoint=function(e,t,n){return sonic.isArray(n)?n.filter(function(n){return n.key===e&&n.point[i.config.definedDataKey]===t[i.config.definedDataKey]}).length>0:!1},i.getLinePointRadius=function(e,t,n){var o=d3.select(this.parentNode).data()[0].key,a=i.config.pointSize;return sonic.isSet(n)&&i.isClosestPoint(o,e,n)&&(a=i.config.highlightPointSize),a},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-line",n),n},lt.add("addLine",M),lt.add("addLines",M),lt.add("updateLine",T),lt.add("updateLines",T),lt.add("removeLine",z),lt.add("removeLines",z),sonic.line.difference=function(e,t){function n(t,o){var a,c;o=o||{},i.selection=t,i.setScales(),i.computeData(o),a=t.selectAll(".sonic-difference."+n.id()).data(i.data).attr("opacity",0),c=a.enter().append("g").classed("sonic-difference "+n.id(),!0),c.append("svg").append("clipPath").attr("id","clip-below-"+n.id()).classed("clip-path clip-below",!0).append("path"),c.append("svg").append("clipPath").attr("id","clip-above-"+n.id(),!0).classed("clip-path clip-above",!0).append("path"),c.append("path").classed("clip-below",!0).attr("fill",i.config.decreaseColor).attr("fill-opacity",i.config.fillOpacity).attr("clip-path","url(#clip-below-"+n.id()+")"),c.append("path").classed("clip-above",!0).attr("fill",i.config.increaseColor).attr("fill-opacity",i.config.fillOpacity).attr("clip-path","url(#clip-above-"+n.id()+")"),a.each(i.updateDifferences),a.exit().attr("opacity",i.config.fillOpacity).transition().delay(e.animation().delay).duration(e.animation().duration).attr("opacity",0).remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,config:{id:null,xDataKey:"x",yDataKey:"y",base:{key:null,index:null},compare:{key:null,index:null},interpolator:"linear",buffer:0,decreaseColor:"blue",increaseColor:"red",fillOpacity:.75}};return i.computeData=function(t){var n,o;i.data=[],n=e.dataBySeries(i.config.base.key,i.config.base.index),o=e.dataBySeries(i.config.compare.key,i.config.compare.index),t.remove||0===n.length||0===o.length||i.data.push({key:"single",baseValues:i.xScale.sort(n[0].values),compareValues:i.xScale.sort(o[0].values)})},i.areaGenerator=function(){return d3.svg.area().interpolate(i.config.interpolator).x(function(e){return i.xScale.position(e[i.config.xDataKey])}).y1(function(e){return i.yScale.position(e[i.config.yDataKey])})},i.setScales=function(){i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id())},i.updateDifferences=function(){var t=d3.select(this),n=i.areaGenerator(),o=t.data()[0];n.y0(e.body().height()),t.select(".clip-path.clip-below path").transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(e){return n(e.baseValues)}),n.y0(0),t.select(".clip-path.clip-above path").transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(e){return n(e.baseValues)}),n.y0(function(e){var t,n;return t=i.xScale.nearest(e,o.compareValues),n=t.dist<=i.config.buffer?t.point[i.config.yDataKey]:e[i.config.yDataKey],i.yScale.position(n)}),t.select("path.clip-above").transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(e){return n(e.baseValues)}),t.select("path.clip-below").transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(e){return n(e.baseValues)}),t.transition().delay(e.animation().delay).duration(e.animation().duration).attr("opacity",i.config.fillOpacity)},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-difference",n),n},lt.add("addDifference",A),lt.add("removeDifference",O),sonic.line.forecast=function(e,t){function n(t){var o,a;i.selection=t,i.computeData(),i.setScales(),o=t.selectAll(".sonic-forecast."+n.id()).data(i.data,function(e){return e.key}),a=o.enter().append("g").classed("sonic-forecast "+n.id(),!0),o.each(i.drawForecast),o.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,config:{xDataKey:"x",yDataKey:"y",strokeWidth:3,stroke:"yellow",fanColor:"lightblue",seriesKeys:null,seriesIndexes:null,fromSeriesKey:null,fromSeriesIndex:null,tooltip:{buffer:{type:"value",amount:null},renderFn:null}}};return i.drawForecast=function(e,t){var n=this;i.drawFan.call(n,e,t),i.drawLine.call(n,e,t)},i.drawFan=function(t){var o,a;a=t.values.length>0&&sonic.isSet(t.values[t.values.length-1].confidences)?t.values[t.values.length-1].confidences.sort(sonic.sortByProp("id")):[],o=d3.select(this).selectAll("g.sonic-forecast."+n.id()+" path.area").data(a,function(e){return e.id}),o.enter().insert("path",":first-child").classed("area",!0).attr("fill",function(e,t){return d3.rgb(i.config.fanColor).darker(t+1)}),o.transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(e){return i.areaGenerator(e.id)(t.values)}),o.exit().remove()},i.drawLine=function(t){var o,a;a=0===t.values.length?[]:[1],o=d3.select(this).selectAll("g.sonic-forecast."+n.id()+" path.line").data(a),o.enter().append("path").classed("line",!0).attr("stroke-width",i.config.strokeWidth).attr("stroke",function(e,n){return i.getLineColor.call(this,e,n,t)}).attr("fill-opacity",0),o.data(t.values).transition().delay(e.animation().delay).duration(e.animation().duration).attr("d",function(){var e=t.values;return i.config.sort&&(e=i.xScale.sort(e)),i.lineGenerator()(e)}),o.exit().remove()},i.getLineColor=function(e,t,n){return n.color||i.config.stroke},i.lineGenerator=function(){return d3.svg.line().x(function(e){return i.xScale.position(e[i.config.xDataKey])}).y(function(e){return i.yScale.position(e[i.config.yDataKey])})},i.areaGenerator=function(e){var t=function(t){return t.confidences.filter(function(t){return t.id===e?!0:!1}).pop()};return d3.svg.area().x(function(e){return i.xScale.position(e[i.config.xDataKey])}).y0(function(e){return e.confidences?i.yScale.position(t(e).low):i.yScale.position(e[i.config.yDataKey])}).y1(function(e){return e.confidences?i.yScale.position(t(e).high):i.yScale.position(e[i.config.yDataKey])})},i.computeData=function(){i.data=[],e.data().forEach(function(e,t){sonic.isSet(i.config.seriesKeys)&&-1!==i.config.seriesKeys.indexOf(e.key)?i.data.push(e):sonic.isSet(i.config.seriesIndexes)&&-1!==i.config.seriesIndexes.indexOf(t)?i.data.push(e):sonic.isSet(i.config.seriesKeys)||sonic.isSet(i.config.seriesIndexes)||i.data.push(e)}),i.isValidDataSet()&&i.addLastActualValue()},i.isValidDataSet=function(){return i.data.every(function(e){return sonic.isSet(e)&&sonic.isArray(e.values)})},i.addLastActualValue=function(){var t,n;i.config.fromSeriesKey?t=e.dataByKey(i.config.fromSeriesKey):i.config.fromSeriesIndex&&(t=e.dataByKey(i.config.fromSeriesKey)),t&&i.data.forEach(function(e){e.values.length>0&&(n=sonic.clone(t.values[t.values.length-1]),n.nonForecast=!0,e.values.unshift(n))})},i.setScales=function(){var t,o;sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id()),t=i.computeMinY(),o=i.computeMaxY(),(i.yScale.domainMin()>t||o>i.yScale.domainMax())&&(i.yScale.domain([t,o],!0),e.refreshRegistry(n.id()))},i.computeMinY=function(){return d3.min(i.data,function(e){return d3.min(e.values,function(e){return e.confidences?d3.min(e.confidences,function(e){return e.low}):e[i.config.yDataKey]})})},i.computeMaxY=function(){return d3.max(i.data,function(e){return d3.max(e.values,function(e){return e.confidences?d3.max(e.confidences,function(e){return e.high}):e[i.config.yDataKey]})})},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),t},i.closestPoints=function(e){var t,n=e[0];return e[1],t=i.data.map(function(e){return{key:e.key,dist:null,point:null}}),i.data.forEach(function(e,o){e.values.forEach(function(e){var a;e.nonForecast||(a=Math.abs(i.xScale.position(e[i.config.xDataKey])-n),(!t[o].point||t[o].dist>a)&&i.pointWithinBuffer(e,a)&&(t[o].point=e,t[o].dist=a))})}),t=t.filter(function(e){return sonic.isSet(e.point)?!0:!1})},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+":</b>"+t.point[i.config.yDataKey],t.point.confidences&&(n+=t.point.confidences.map(function(e){return"<br /><b>"+e.id+"%:</b>"+" ("+e.low+", "+e.high+")"}).join("")),n+"</p>"}).reduce(function(e,t){return e+t})},i.pointWithinBuffer=function(e,t){var n=!0;return sonic.isSet(i.config.tooltip.buffer.amount)&&("value"===i.config.tooltip.buffer.type?i.xScale.domainRangeToInterval(t)>i.config.tooltip.buffer.amount&&(n=!1):t>i.config.tooltip.buffer.amount&&(n=!1)),n},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-forecast",n),n},lt.add("addForecast",E),sonic.line.rule=function(e,t){function n(t,o){var a,c;[i.config.cls,"sonic-rule"],i.selection=t,o=o||{},sonic.isSet(i.config.axisPin.id)&&(c=e.componentSingleton().find("sonic-axis",i.config.axisPin.id)[0].scale()),i.computeData(o,c),a=t.selectAll(".sonic-rule."+n.id()).data(i.data,function(){return n.id()}),a.enter().append("g").classed("sonic-rule "+n.id()+" "+i.config.type,!0).classed("mouse",function(){return i.config.followMouse}).attr("stroke",i.config.stroke).append("path").attr("stroke-width",i.config.strokeWidth).attr("opacity",function(e){return e[0].enabled?1:0}),a.each(i.drawRule),a.exit().remove(),e.registerVisibleContent(n,!1)}var i={config:{id:null,cls:"",axisPin:{id:null,x:null,y:null},dashed:{show:!1,stroke:"3,3"},stroke:"grey",strokeWidth:1,position:null,type:null,length:null,offset:{length:0},followMouse:!1}};return i.drawRule=function(){var t,n=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),o=e.animation().delay,a=e.animation().duration;i.config.followMouse?(o=0,a=0):i.config.animation&&(o=sonic.isSet(i.config.animation.delay)?i.config.animation.delay:o,a=sonic.isSet(i.config.animation.duration)?i.config.animation.duration:a),t=d3.select(this).select("path").transition().delay(o).duration(a).attr("d",n),i.config.dashed.show&&(t=t.style("stroke-dasharray",i.config.dashed.stroke))},i.computeData=function(t,n){var o,a,c=i.config.position,r=!0,l=c*e.body().height(),s=c*e.body().width();i.data=[],t.remove||(sonic.isSet(c)||sonic.isSet(i.config.axisPin.x)||sonic.isSet(i.config.axisPin.y)||(r=!1,c=0),"x"===i.config.type?(i.config.length?o=i.config.length:(o=e.body().width(),"right"===i.config.offset.anchor&&(o=-1*o)),a=i.config.offset.length,"right"===i.config.offset.anchor&&(a+=e.body().width()),sonic.isSet(i.config.axisPin.y)&&(l=n.position(i.config.axisPin.y)),i.data.push([{x:a,y:l,enabled:r},{x:o+a,y:l,enabled:r}])):"y"===i.config.type&&(i.config.length?o=i.config.length:(o=-1*e.body().height(),"top"===i.config.offset.anchor&&(o=-1*o)),a=e.body().height()+i.config.offset.length,"top"===i.config.offset.anchor&&(a=i.config.offset.length),sonic.isSet(i.config.axisPin.x)&&(s=n.position(i.config.axisPin.x)),i.data.push([{x:s+(i.config.offset&&i.config.offset.x?i.config.offset.x:0),y:a,enabled:r},{x:s+(i.config.offset&&i.config.offset.x?i.config.offset.x:0),y:o+a,enabled:r}])))},i.onVizMouseMove=function(e){e?(d3.select(".sonic-rule."+n.id()+".mouse.x"+" path").attr("opacity",1).attr("transform",function(){return"translate(0 , "+e[1]+")"}),d3.select(".sonic-rule."+n.id()+".mouse.y"+" path").attr("opacity",1).attr("transform",function(){return"translate("+e[0]+", 0)"})):d3.select(".sonic-rule."+n.id()+".mouse"+" path").attr("opacity",0)},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-rule",n),n},lt.add("addRule",F),lt.add("removeRule",B),lt.add("updateRule",W),lt.add("addCrosshair",j),sonic.bar=function(e,t){function n(t,o){var a,c,r,l,s=[i.config.cls,"sonic-bar"];i.selection=t,i.computeData(o||{}),i.setScales(),i.computeBarWidth(),a=t.selectAll(s.join(".")+"."+n.id()).data(i.data,function(e){return e.key}),a.enter().append("g").classed(s.join(" ")+" "+n.id(),!0),r=sonic.isSet(i.config.animation.delay)?i.config.animation.delay:e.animation().delay,l=sonic.isSet(i.config.animation.duration)?i.config.animation.duration:e.animation().duration,c=r>0||l>0?a.transition().delay(r).duration(l):a,c.attr("stroke",function(e,t){return""+d3.rgb(i.getBarColor(e,t)).darker()}).attr("fill",i.getBarColor),a.each(function(e,t){i.drawBars.call(this,e,t,o||{})}),a.each(i.setupLegend),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,barGroupWidth:null,barWidth:null,groupIndex:null,defaultColors:sonic.colors.colorMap(),config:{type:"grouped",id:null,cls:"",definedDataKey:"id",xDataKey:"x",yDataKey:"y",labelKey:"label",xScaleId:null,yScaleId:null,seriesKeys:null,seriesIndexes:null,stroke:"black",fill:"",animation:{duration:null,delay:null},strokeWidth:1,fillOpacity:1,barPosition:"center",minBarWidth:8,maxBarWidth:50,barWidth:null,barPadding:0,barGroupPadding:5,highlightOnHover:!0,drawLabels:!1,labelStyle:{fontSize:10,fontFamily:"arial",fill:null,stroke:"none",anchor:"middle"},tooltip:{type:"grouped",renderFn:null}}};return i.computeData=function(t){i.data=[],t.remove||(i.data=e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes),i.groupIndex={},0!==i.data.length&&(i.data.forEach(function(e){e.values.forEach(function(t){i.groupIndex[t[i.config.xDataKey]]||(i.groupIndex[t[i.config.xDataKey]]=[]),-1===i.groupIndex[t[i.config.xDataKey]].indexOf(e.key)&&i.groupIndex[t[i.config.xDataKey]].push(e.key)})}),"stacked"===i.config.type&&i.computeStackedData()))},i.computeStackedData=function(){var e=d3.layout.stack().values(function(e){return e.values}).x(function(e){return e[i.config.xDataKey]}).y(function(e){return e[i.config.yDataKey]});i.data=sonic.clone(i.data).map(function(e){return d3.keys(i.groupIndex).forEach(function(t){var n=t,o={};sonic.string.isNumeric(n)&&(n=parseInt(n,10)),e.values.some(function(e){return sonic.isDate(e[i.config.xDataKey])?(sonic.isDate(n)||(n=new Date(n)),e[i.config.xDataKey].getTime()===n.getTime()?!0:!1):e[i.config.xDataKey]===n?!0:!1})||(o[i.config.xDataKey]=n,o[i.config.yDataKey]=0,o.filler=!0,e.values.push(o))}),e.values.sort(function(e,t){return e[i.config.xDataKey]<t[i.config.xDataKey]?-1:1}),e}),i.data=e(i.data)},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id()),"stacked"===i.config.type?i.transitionAxisToStacked():i.transitionAxisToGrouped()},i.setupLegend=function(e){d3.select(this).selectAll("rect").attr(n.id()+"-data-legend",function(){return e.name||e.key}).attr("data-legend-color",function(t){return e.color||e.stroke||t.color||t.stroke})},i.drawBars=function(t,n,o){var a,c,r=i.getBarGroupDelay,l=e.animation().duration;
a=d3.select(this).selectAll("rect").data(function(e){return e.values},function(e){return e[i.config.definedDataKey]}),sonic.isSet(i.config.animation.delay)&&(r=i.config.animation.delay),sonic.isSet(i.config.animation.duration)&&(l=i.config.animation.duration),a.enter().append("rect").attr("stroke-width",i.config.strokeWidth).attr("fill-opacity",i.config.fillOpacity).attr("x",i.getBarAlignment).attr("width",i.barWidth).attr("y",i.getBarInitY).attr("height",0).attr("fill",i.getDataPointColor).attr("stroke",i.getDataPointStrokeColor),c=r>0||l>0?a.transition().delay(r).duration(l):a,"stacked"===i.config.type?c.attr("fill",i.getDataPointColor).attr("stroke",i.getDataPointStrokeColor).attr("stroke-width",i.config.strokeWidth).attr("fill-opacity",i.config.fillOpacity).attr("y",function(e){return i.yScale.position(e.y0+e[i.config.yDataKey],"center")}).attr("height",function(e){return i.yScale.position(e.y0)-i.yScale.position(e.y0+e[i.config.yDataKey],"center")}).transition().attr("x",i.getBarAlignment).attr("width",function(){return i.barWidth}):c.attr("fill",i.getDataPointColor).attr("stroke",i.getDataPointStrokeColor).attr("stroke-width",i.config.strokeWidth).attr("fill-opacity",i.config.fillOpacity).attr("x",function(e,n){return i.getGroupedBarPosition(e,n,t.key)}).attr("width",i.barWidth).transition().attr("y",i.getGroupedBarY).attr("height",i.getGroupedBarHeight),sonic.isSet(i.config.animation.delay)||(r=e.animation().delay),c=r>0||e.animation().duration>0?a.exit().transition().delay(r).duration(e.animation().duration):a.exit(),c.attr("y",function(){return e.body().height()}).attr("height",0).remove(),i.config.drawLabels!==!1&&i.drawLabels.call(this,t,n,o)},i.getLabelX=function(e,t,n){var o;return o=i.getGroupedBarPosition(e,t,n.key),("center"===i.config.barPosition||"bin"===i.config.barPosition)&&(o+=i.barWidth/2),o},i.getLabelY=function(){var e;return e="top"===i.config.drawLabels?i.getGroupedBarY.apply(this,arguments)-5:i.getGroupedBarY.apply(this,arguments)+i.getGroupedBarHeight.apply(this,arguments)+15},i.drawLabels=function(t){var n,o,a=i.getBarGroupDelay,c=e.animation().duration;n=d3.select(this).selectAll(".sonic-bar-label").data(function(e){return e.values},function(e){return e[i.config.definedDataKey]}),sonic.isSet(i.config.animation.delay)&&(a=i.config.animation.delay),sonic.isSet(i.config.animation.duration)&&(c=i.config.animation.duration),n.enter().append("text").classed("sonic-bar-label",!0).attr("x",i.getBarAlignment).attr("y",i.getBarInitY),o=a>0||c>0?n.transition().delay(a).duration(c):n,"stacked"===i.config.type||o.attr("x",function(e,n){return i.getLabelX.call(this,e,n,t)}).attr("y",function(e,n){return i.getLabelY.call(this,e,n,t)}).style("fill",i.config.labelStyle.fill).style("stroke","none").style("font-size",i.config.labelStyle.fontSize+"px").style("font-family",i.config.labelStyle.fontFamily).style("text-anchor",i.config.labelStyle.anchor).text(function(e){return e[i.config.labelKey]}),sonic.isSet(i.config.animation.delay)||(a=e.animation().delay),o=a>0||e.animation().duration>0?n.exit().transition().delay(a).duration(e.animation().duration):n.exit(),o.attr("y",e.body().height()).remove()},i.computeBarWidth=function(){var e=i.data.length;i.barGroupWidth="ordinal"===i.xScale.type()?i.xScale.rangeBand():sonic.isObject(i.config.barWidth)?i.xScale.domainIntervalToRange(i.config.barWidth.amount):Math.floor(i.xScale.rangeExtent()/(sonic.array.maxLength(i.data)*e)),i.barGroupWidth=i.barGroupWidth-2*i.config.barGroupPadding,i.barWidth=sonic.isSet(i.config.barWidth)?sonic.isObject(i.config.barWidth)?i.xScale.domainIntervalToRange(i.config.barWidth.amount):i.config.barWidth:"stacked"===i.config.type||1===e?i.barGroupWidth:Math.floor((i.barGroupWidth-2*e*i.config.barPadding)/e),sonic.isSet(i.config.barWidth)||(i.barWidth<i.config.minBarWidth?i.barWidth=i.config.minBarWidth:i.barWidth>i.config.maxBarWidth&&(i.barWidth=i.config.maxBarWidth)),sonic.isSet(i.config.tooltip.buffer)||(i.config.tooltip.buffer={type:"pixel",value:i.barWidth})},i.getBarColor=function(e,t){return e.color||i.config.fill||i.defaultColors(t)},i.getDataPointColor=function(e){return e.color||void 0},i.getDataPointStrokeColor=function(e){return e.stroke?e.stroke:e.color?d3.rgb(e.color).darker():void 0},i.getBarSeriesIdx=function(e){var t=0;return i.data.forEach(function(n,i){n.values.indexOf(e)>=0&&(t=i)}),t},i.getBarGroupDelay=function(e){var t,n=0;return sonic.isSet(i.groupIndex)&&(t=d3.keys(i.groupIndex).sort(function(e,t){var n=sonic.string.isNumeric(e)?parseInt(e,10):e,o=sonic.string.isNumeric(t)?parseInt(t,10):t;return i.xScale.position(n,i.config.barPosition)<i.xScale.position(o,i.config.barPosition)?-1:1}).indexOf(e[i.config.xDataKey]+""),n=-1===t?0:200*t),n},i.getBarAlignment=function(e){var t=i.xScale.position(e[i.config.xDataKey],i.config.barPosition);return"center"===i.config.barPosition&&(t-=i.barWidth/2),t},i.getGroupedBarPosition=function(e,t,n,o){var a=i.groupIndex[e[i.config.xDataKey]],c=0,r=i.xScale.position(e[i.config.xDataKey],i.config.barPosition);return sonic.isSet(a)&&(c=a.indexOf(n),-1!==c&&(r+=c*(i.barWidth+2*i.config.barPadding),"center"===i.config.barPosition&&(r+=-1*a.length*(i.barWidth+i.config.barPadding)/2))),o&&"center"===o?r+=(i.barWidth+i.config.barPadding)/2:o&&"max"===o&&(r+=i.barWidth+2*i.config.barPadding),r},i.getGroupedBarY=function(e){var t=e.y0,n=e[i.config.yDataKey];return sonic.isSet(t)&&(n=Math.max(n,t)),i.yScale.position(n,i.config.barPosition)},i.getBarInitY=function(t){var n=t.y0,o=e.body().height();return sonic.isSet(n)&&"grouped"===i.config.type&&(o=i.yScale.position(t.y0,i.config.barPosition)),o},i.getGroupedBarHeight=function(t){var n=t.y0,o=e.body().height();return t[i.config.yDataKey],sonic.isSet(n)&&(o=i.yScale.position(n,i.config.barPosition)),Math.abs(i.yScale.position(t[i.config.yDataKey],i.config.barPosition)-o)},i.transitionAxisToStacked=function(){var t=i.yScale.domainMax();i.yScale.domainMax(d3.max(i.data,function(e){return d3.max(e.values,function(e){return e.y0+e[i.config.yDataKey]})})),t!==i.yScale.domainMax()&&e.refreshRegistry(n.id())},i.transitionAxisToGrouped=function(){var t=i.yScale.domainMax();i.yScale.domainMax(d3.max(i.data,function(e){return d3.max(e.values,function(e){return e[i.config.yDataKey]})})),t!==i.yScale.domainMax()&&e.refreshRegistry(n.id())},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e,i.config.tooltip.type)),i.config.highlightOnHover&&i.selection.selectAll("."+n.id()+" rect").style("fill",function(e){var n=e.color||d3.select(this.parentNode).attr("fill");return t&&t.filter(function(t){return e===t.point}).length>0?d3.rgb(n).brighter():null}).attr("stroke-width",function(e){var n=i.config.strokeWidth;return t&&t.filter(function(t){return e===t.point}).length>0?n+1:n}),i.updateTooltips(e,t),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),t},i.closestPoints=function(e,t){var n,o,a,c,r,l,s,d=e[0];return e[1],n=i.data.map(function(e){var t={point:null,dist:null};return sonic.each(e,function(e,n){"values"!==e&&(t[e]=n)}),t}),i.data.forEach(function(e,o){for(var f=0;e.values.length>f;f++)a=e.values[f],c=i.xScale.position(a[i.config.xDataKey]),r=i.xScale.position(a[i.config.xDataKey])+Math.max(i.barGroupWidth,i.barWidth||0),l=null,s=!1,"stacked"===i.config.type&&a.filler===!0&&(s=!0),!s&&d>=c&&r>=d&&("single"!==t?l=Math.abs(i.xScale.position(a[i.config.xDataKey],i.config.barPosition)-d):i.config.stacked||(l=Math.abs(i.getGroupedBarPosition(a,null,e.key,i.config.barPosition)-d)),n[o].point=a,n[o].dist=l)}),n=n.filter(function(t){if(!sonic.isSet(t.point))return!1;if(sonic.isSet(i.config.tooltip.buffer)&&sonic.isSet(i.config.tooltip.buffer.amount))if("value"===i.config.tooltip.buffer.type){if(i.xScale.domainRangeToInterval(Math.abs(i.xScale.position(t.point[i.config.xDataKey])-e[0]))>i.config.tooltip.buffer.amount)return!1}else if(Math.abs(i.xScale.position(t.point[i.config.xDataKey])-e[0])>i.config.tooltip.buffer.amount)return!1;return!0}),"single"===t&&n.length>0&&(o=n[0],n.forEach(function(e){e.dist<o.dist&&(o=e)}),n=[o]),"stacked"===i.config.type&&n.reverse(),n},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+":</b>"+t.point[i.config.yDataKey],n+"</p>"}).reduce(function(e,t){return e+t})},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-bar",n),n},lt.add("addBars",L),lt.add("updateBars",G),lt.add("removeBars",R),sonic.bar.significance=function(e,t){function n(t){var o;i.selection=t,i.computeData(),i.setScales(),o=t.selectAll(".sonic-significance-bar."+n.id()).data(i.data,function(e){return e.key}),o.enter().append("g").classed("sonic-significance-bar "+n.id(),!0),o.each(i.drawBars),o.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,config:{id:null,xDataKey:"x",yDataKey:"y",zDataKey:"z",xScaleId:null,yScaleId:null,low:{color:"blue",threshold:.25},high:{color:"red",threshold:.75},nonSignificanceBars:{hidden:!0,color:"transparent"},brightShading:{active:!1,hoverColor:null},fillOpacity:.75,strokeWidth:1,barPadding:3,widthPadVal:0,pointerHand:!1,tooltip:{type:"grouped",renderFn:null},suppressGrouping:!1}};return i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),t},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),i.selection.selectAll("g.sonic-significance-bar rect").attr("fill",function(e){var n;return n=i.config.brightShading.active?i.brightShade(i.config[e.type].color,e.type,e.z):i.config[e.type].color,t&&t.point[i.config.yDataKey]===e[i.config.yDataKey]&&t.point[i.config.xDataKey]===e[i.config.xDataKey]?i.config.brightShading.hoverColor||""+d3.rgb(i.config[e.type].color).brighter().brighter():n}),t},i.closestPoints=function(e){var t=e[0],n=e[1],o=null;return i.data.forEach(function(e){e.values.forEach(function(a){var c=Math.abs(i.xScale.position(a[i.config.xDataKey])),r=Math.abs(i.xScale.position(a[i.config.xDataKey])+i.getRectWidth(a)),l=Math.abs(i.yScale.position(a[i.config.yDataKey])),s=Math.abs(i.yScale.position(a[i.config.yDataKey])+i.getRectHeight(a));t>=c&&r>=t&&n>=l&&s>=n&&(o={point:a,key:e.key})})}),o},i.drawBars=function(){var t=d3.select(this).selectAll("rect").data(function(e){return e.values});t.enter().append("rect").attr("stroke-width",i.config.strokeWidth).attr("fill-opacity",i.config.fillOpacity).attr("series",function(e){return e[i.config.yDataKey]}).attr("cursor",i.config.pointerHand?"pointer":""),t.transition().delay(e.animation().delay).duration(e.animation().duration).attr("stroke-width",i.config.strokeWidth).attr("stroke",function(e){return"nonSignificanceBars"===e.type?void 0:""+d3.rgb(i.config[e.type].color).darker()}).attr("fill",function(e){return i.config.brightShading.active?i.brightShade(i.config[e.type].color,e.type,e.z):i.config[e.type].color}).attr("x",function(e){return i.xScale.position(e[i.config.xDataKey])}).attr("y",function(e){return i.yScale.position(e[i.config.yDataKey])+i.config.barPadding}).attr("width",function(e){return i.getRectWidth(e)}).attr("height",function(e){return i.getRectHeight(e)}),t.exit().remove()},i.getRectWidth=function(e){var t;return t=sonic.isSet(e.toKey)?i.xScale.position(e.toKey)-i.xScale.position(e[i.config.xDataKey]):i.xScale.domainIntervalToRange(i.config.widthPadVal)},i.getRectHeight=function(){return i.yScale.rangeBand()-2*i.config.barPadding},i.transformPoint=function(e,t,n){var o={};return o[i.config.xDataKey]=t[0][i.config.xDataKey],o.toKey=t.length>1?t[t.length-1][i.config.xDataKey]:null,o[i.config.yDataKey]=e.key,o.type=n,o.ztotal=t.length>1?t.reduce(function(e,t){return{z:e.z+t.z}}).z:t[0].z,o.z=o.ztotal/t.length,o.breakdown=t,o},i.computeData=function(){i.data=[],e.data().forEach(function(e){var t,n=[],o=[],a=[],c={key:e.key,values:[]};t=e.values.sort(sonic.sortByProp(i.config.xDataKey)),t.forEach(function(r,l){var s={};i.config.nonSignificanceBars.hidden===!1&&("insignificant"===r[i.config.zDataKey]||r[i.config.zDataKey]>=i.config.low.threshold&&r[i.config.zDataKey]<=i.config.high.threshold)&&(a.push(r),s=i.transformPoint(e,a,"nonSignificanceBars"),c.values.push(s),a=[]),r[i.config.zDataKey]<i.config.low.threshold&&n.push(r),n.length&&(i.config.suppressGrouping||r[i.config.zDataKey]>i.config.low.threshold||l===t.length-2)&&(s=i.transformPoint(e,n,"low"),c.values.push(s),n=[]),r[i.config.zDataKey]>i.config.high.threshold&&o.push(r),o.length&&(i.config.suppressGrouping||r[i.config.zDataKey]<i.config.high.threshold||l===t.length-2)&&(s=i.transformPoint(e,o,"high"),c.values.push(s),o=[])}),i.data.push(c)})},i.setScales=function(){i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:"x"}),i.config.xScaleId=i.xScale.id()),t.widthPadVal||("time"===i.xScale.type()?i.config.widthPadVal=864e5:"linear"===i.xScale.type()&&(i.config.widthPadVal=1)),i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:"y"}),i.config.yScaleId=i.yScale.id())},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return"<p><b>"+i.config.xDataKey+": </b>"+e.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+": </b>"+e.point[i.config.yDataKey]+"<br />"+"<b>"+i.config.zDataKey+": </b>"+e.point[i.config.zDataKey]+"</p>"},i.brightShade=function(e,t,n){var o=100;return"high"===t?""+d3.rgb(i.config[t].color).brighter(Math.abs(n-i.config.high.threshold)*o):"low"===t?""+d3.rgb(i.config[t].color).brighter(Math.abs(n-i.config.low.threshold)*o):i.config[t].color},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-significance-bar",n),n},lt.add("addSignificanceBars",_),lt.add("updateSignificanceBars",N),sonic.bar.overlay=function(e,t){function n(t,o){var a,c=[i.config.cls,"sonic-bar-overlay"];i.selection=t,i.computeData(o||{}),i.setScales(),a=t.selectAll(c.join(".")+"."+n.id()).data(i.data,function(e){return e.key}),a.enter().append("g").classed(c.join(" ")+" "+n.id(),!0),a.each(i.drawOverlays),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,config:{xDataKey:"x",xToDataKey:"x2",seriesKeys:null,seriesIndexes:null,fill:"orange",fillOpacity:.5,tooltip:{renderFn:null}}};return i.drawOverlays=function(t){var n=d3.select(this).selectAll("rect").data(function(e){return e.values});n.enter().append("rect").attr("fill",function(e,n){return i.getFillColor.call(this,e,n,t)}).attr("fill-opacity",i.config.fillOpacity).attr("x",i.getX).attr("y",i.getY).attr("width",i.getWidth).attr("height",0),n.transition().delay(e.animation().delay).duration(e.animation().duration).attr("x",i.getX).attr("y",i.getY).attr("width",i.getWidth).attr("height",i.getHeight),n.exit().remove()},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.yScale&&(i.config.yScaleId=i.yScale.id()))},i.computeData=function(t){i.data=[],t.remove||(i.data=e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes))},i.getX=function(e){return Math.min(i.xScale.position(e[i.config.xDataKey]),i.xScale.position(e[i.config.xToDataKey]))},i.getWidth=function(e){return Math.abs(i.xScale.position(e[i.config.xToDataKey])-i.xScale.position(e[i.config.xDataKey]))},i.getHeight=function(){return i.yScale?i.yScale.rangeExtent():e.body().height()},i.getY=function(){return i.yScale?i.yScale.rangeMin():0},i.getFillColor=function(e,t,n){return n.color||e.color||i.config.fill},i.getStrokeColor=function(e,t,n){return""+d3.rgb(i.getFillColor(e,t,n)).darker()},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),t},i.closestPoints=function(e){var t=[],n=e[0];return e[1],i.data.forEach(function(e){e.values.forEach(function(o){var a,c,r=i.xScale.position(o[i.config.xDataKey]),l=i.xScale.position(o[i.config.xToDataKey]),s={};r>l&&(a=r,r=l,l=a),c=Math.abs((l-r)/2-n),n>=r&&l>=n&&(s={point:o,dist:c},sonic.each(e,function(e,t){"values"!==e&&(s[e]=t)}),t.push(s))})}),t},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.xToDataKey+":</b>"+t.point[i.config.xToDataKey]+"<br />",n+"</p>"}).join("")},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-bar-overlay",n),n},lt.add("addOverlayBars",V),lt.add("removeOverlayBars",q),sonic.bar.matrix=function(e,t){function n(t){var o;i.selection=t,i.computeData(),i.setScales(),o=t.selectAll(".sonic-matrix."+n.id()).data(i.data,function(e){return e.key}),o.enter().append("g").classed("sonic-matrix "+n.id(),!0),o.each(i.drawRects),o.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,zScale:null,config:{xDataKey:"x",yDataKey:"y",zDataKey:"z",quantize:!0,barPadding:5,buckets:5,fillOpacity:.6,colors:["#FF0000","#f46d43","#f6faaa","#abdda4","#008000"],tooltip:{type:"grouped"}}};return i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),t},i.closestPoints=function(e){var t=e[0],n=e[1],o=null;return i.data.forEach(function(e){e.values.forEach(function(a){var c=Math.abs(i.xScale.position(a[i.config.xDataKey])),r=Math.abs(i.xScale.position(a[i.config.xDataKey])+i.getRectWidth()),l=Math.abs(i.yScale.position(a[i.config.yDataKey])),s=Math.abs(i.yScale.position(a[i.config.yDataKey])+i.getRectHeight());t>=c&&r>=t&&n>=l&&s>=n&&(o={point:a,key:e.key,keyName:e.keyName})})}),o},i.drawRects=function(){var t=d3.select(this).selectAll("rect").data(function(e){return e.values});t.enter().append("rect").attr("fill-opacity",i.config.fillOpacity).attr("x",function(e){return i.xScale.position(e[i.config.xDataKey])+i.config.barPadding}).attr("y",function(e){return i.yScale.position(e[i.config.yDataKey])}),t.transition().delay(e.animation().delay).duration(e.animation().duration).attr("stroke-width",i.config.strokeWidth).attr("fill",function(e){return i.config.colors[i.zScale(e[i.config.zDataKey])]}).attr("x",function(e){return i.xScale.position(e[i.config.xDataKey])+i.config.barPadding}).attr("y",function(e){return i.yScale.position(e[i.config.yDataKey])}).attr("width",i.getRectWidth()).attr("height",i.getRectHeight()),t.exit().remove()},i.getRectWidth=function(){return i.xScale.rangeBand()-i.config.barPadding},i.getRectHeight=function(){return i.yScale.rangeBand()-2*i.config.barPadding},i.setScales=function(){var t;sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id()),i.config.quantize===!1?i.zScale=d3.scale.identity(d3.range(0,i.config.buckets)):(t=i.data.reduce(function(e,t){return e.concat(t.values.map(function(e){return e[i.config.zDataKey]}))},[]),i.zScale=d3.scale.quantile().domain(t).range(d3.range(0,i.config.buckets)))},i.computeData=function(){i.data=sonic.isSet(i.config.seriesKey)?[e.dataByKey(i.config.seriesKey)]:sonic.isSet(i.config.seriesIndex)?[e.dataByIndex(i.config.seriesIndex)]:e.data()},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return"<p><b>"+i.config.xDataKey+": </b>"+e.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+": </b>"+e.point[i.config.yDataKey]+"<br />"+"<b>"+i.config.zDataKey+": </b>"+e.point[i.config.zDataKey]+"</p>"},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-matrix",n),n},lt.add("addMatrix",H),sonic.area=function(e,t){function n(t,o){var a,c=[i.config.cls,"sonic-area",n.id()];i.selection=t,i.computeData(o||{}),i.setScales(),a=t.selectAll(c.join(".")).data(i.data,function(e){return e.key}),a.enter().insert("g").classed(c.join(" "),!0).append("path").attr("fill",i.config.startingFill),a.each(i.drawAreas),a.each(i.setupLegend),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,defaultColors:sonic.colors.colorMap(),config:{type:"basic",interpolator:"linear",offset:"zero",id:null,cls:"",definedDataKey:"id",xDataKey:"x",yDataKey:"y",xScaleId:null,yScaleId:null,seriesKeys:null,seriesIndexes:null,stroke:"black",fill:null,startingFill:"#FFF",sort:!1,animation:{duration:null,delay:null},strokeWidth:1,fillOpacity:1,tooltip:{buffer:{type:"value",amount:null},renderFn:null}}};return i.computeData=function(t){i.data=[],t.remove||(i.data=e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes),0!==i.data.length&&("stacked"===i.config.type&&i.computeStackedData(),i.data.forEach(function(e,t){e.index=t})))},i.computeStackedData=function(){var e,t;t=d3.layout.stack().values(function(e){return e.values}).x(function(e){return e[i.config.xDataKey]}).y(function(e){return e[i.config.yDataKey]}).offset(i.config.offset),e=sonic.array.unique(i.data.map(function(e){return e.values.map(function(e){return e[i.config.xDataKey]})})),i.data=sonic.clone(i.data).map(function(t){return e.forEach(function(e){var n={};sonic.array.contains(sonic.array.pluck(t.values,i.config.xDataKey),e)||(n[i.config.xDataKey]=e,n[i.config.yDataKey]=0,n.filler=!0,t.values.push(n))}),t.values.sort(sonic.sortByProp(i.config.xDataKey)),t}),i.data=t(i.data)},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id()),"stacked"===i.config.type?i.transitionAxisToStacked():i.transitionAxisToBasic()},i.transitionAxisToStacked=function(){var t=i.yScale.domainMin(),o=i.yScale.domainMax();0!==i.data.length&&(i.yScale.domainMin(d3.min(i.data,function(e){return d3.min(e.values,function(e){return e.y0})})),i.yScale.domainMax(d3.max(i.data,function(e){return d3.max(e.values,function(e){return e.y0+e[i.config.yDataKey]})})),(i.yScale.domainMax()!==o||i.yScale.domainMin()!==t)&&e.refreshRegistry(n.id()))},i.transitionAxisToBasic=function(){var t=i.yScale.domainMax();i.yScale.domainMax(d3.max(i.data,function(e){return d3.max(e.values,function(e){return e[i.config.yDataKey]})})),t!==i.yScale.domainMax()&&e.refreshRegistry(n.id())},i.setupLegend=function(e){d3.select(this).selectAll("path").attr(n.id()+"-data-legend",function(){return e.name||e.key})},i.drawAreas=function(t){var n=i.areaGenerator();d3.select(this).selectAll("path").data(i.data).transition().delay(e.animation().delay).duration(e.animation().duration).attr("fill",function(e,n){return i.getFillColor.call(this,e,n,t)}).attr("fill-opacity",i.config.fillOpacity).attr("stroke",function(e,n){var o=i.getFillColor.call(this,e,n,t);return o&&(o=d3.rgb(o).darker()),o}).attr("stroke-width",i.config.strokeWidth).attr("d",function(){var e=t.values;return i.config.sort&&(e=i.xScale.sort(e)),n(e)})},i.areaGenerator=function(){return d3.svg.area().interpolate(i.config.interpolator).x(function(e){return i.xScale.position(e[i.config.xDataKey])}).y0(function(e){return"stacked"===i.config.type?i.yScale.position(e.y0):i.yScale.position(i.yScale.domainMin())}).y1(function(e){return"stacked"===i.config.type?i.yScale.position(e.y0+e[i.config.yDataKey]):i.yScale.position(e[i.config.yDataKey])})},i.getFillColor=function(e,t,n){return n.color||i.config.fill||i.defaultColors(n.index)},i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),t},i.closestPoints=function(e){var t,n,o=[],a=e[0],c=e[1];if(sonic.isSet(i.config.tooltip.buffer.value)===!0){if(t=c>=i.yScale.rangeMin()&&i.yScale.rangeMax()>=c,t===!1)return[]}else n=!0;return(t||n)&&(o=i.data.map(function(e){var t={dist:null,point:null};return sonic.each(e,function(e,n){"values"!==e&&(t[e]=n)}),t}),i.data.forEach(function(e,t){e.values.forEach(function(e){var n=Math.abs(i.xScale.position(e[i.config.xDataKey],"center")-a);e.filler||(!o[t].point||o[t].dist>n)&&i.pointWithinBuffer(e,n)&&(o[t].point=e,o[t].dist=n)})}),o=o.filter(function(e){return sonic.isSet(e.point)?!0:!1})),o},i.pointWithinBuffer=function(e,t){var n=!0;return sonic.isSet(i.config.tooltip.buffer.amount)&&("value"===i.config.tooltip.buffer.type?i.xScale.domainRangeToInterval(t)>i.config.tooltip.buffer.amount&&(n=!1):t>i.config.tooltip.buffer.amount&&(n=!1)),n},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(t){var n="<p>";return(e.length>1||i.config.tooltip&&"global"===i.config.tooltip.type)&&(n=n+"<b><u>"+t.key+"</u></b><br />"),n=n+"<b>"+i.config.xDataKey+":</b>"+t.point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+":</b>"+t.point[i.config.yDataKey],n+"</p>"}).reduce(function(e,t){return e+t})},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-area",n),n},lt.add("addArea",Y),lt.add("addAreas",Y),lt.add("removeAreas",X),lt.add("updateAreas",Z),sonic.pie=function(e,t){function n(t){var o,a;[i.config.cls,"sonic-pie"],i.selection=t,i.computeData(),i.computeRadii(),o=t.selectAll(".sonic-slice."+n.id()).data(i.data,function(e){return e.data.id}),a=o.enter().append("g").classed("sonic-slice "+n.id(),!0),o.attr("transform","translate("+e.body().width()/2+","+e.body().height()/2+")"),a.append("path").attr("d",i.arcGenerator()).style("fill",function(e){return e.data.color||i.config.colors(e.data.id)}).attr("fill-opacity",1).attr("stroke-width",1).attr("stroke-opacity",1).attr("stroke",function(e){var t=e.data.color||i.config.colors(e.data.id);return""+d3.rgb(t).darker()}).each(function(e){this._current=e}),a.append("text").attr("dy",".35em").style("text-anchor","middle").style("font-weight","bold"),o.each(i.updateSlice),o.exit().remove(),e.registerVisibleContent(n,n.hasContent)}var i={innerRadius:null,outerRadius:null,config:{id:null,innerRadius:null,outerRadius:null,yDataKey:"y",showLabels:!0,labelDataKey:"id",innerScale:.6,outerScale:.9,thresholdToLabel:.17,labelSize:null,colors:sonic.colors.colorMap(),tooltip:{buffer:null,type:"grouped"}}};return i.onVizClick=function(){},i.onVizMouseMove=function(e){var t=i.closestPoints(e);return i.updateTooltips(e,t),t},i.closestPoints=function(t){var o,a,c=[],r=t,l=[e.body().width()/2,e.body().height()/2],s=-1;if(r)switch(o=[r[0]-l[0],r[1]-l[1]],a=0>o[0]?0>o[1]?1:4:0>o[1]?2:3,o=o.map(function(e){return Math.abs(e)}),a){case 1:s=2*Math.PI-Math.atan(o[0]/o[1]);break;case 2:s=Math.atan(o[0]/o[1]);break;case 3:s=Math.PI-Math.atan(o[0]/o[1]);break;case 4:s=Math.PI+Math.atan(o[0]/o[1])}return i.selection.selectAll(".sonic-slice."+n.id()+" path").style("fill",function(e){var t=e.data.color||i.config.colors(e.data.id);return i.isSliceSelected(e,s,o)?(c.push(e),""+d3.rgb(t).brighter()):t}).attr("stroke",function(e){var t=e.data.color||i.config.colors(e.data.id);return i.isSliceSelected(e,s,o)?e.data.color||i.config.colors(e.data.id):t}).attr("stroke-width",function(e){return i.isSliceSelected(e,s,o)?2:1}),c},i.isSliceSelected=function(e,t,n){var o,a=!1;return sonic.isSet(e)&&sonic.isSet(e.startAngle)&&sonic.isSet(e.endAngle)&&sonic.isSet(n)&&sonic.isSet(n[0])&&sonic.isSet(n[1])?(o=sonic.geom.pythagorize(n[0],n[1]),o>=i.innerRadius&&i.outerRadius>=o&&t>=e.startAngle&&e.endAngle>=t):a},i.updateSlice=function(){if(d3.select(this).select("path").transition().delay(e.animation().delay).duration(e.animation().duration).attrTween("d",i.arcTween),i.config.showLabels){var t=d3.select(this).select("text");t.transition().delay(e.animation().delay).duration(e.animation().duration).attr("transform",function(e){return"translate("+i.arcGenerator().centroid(e)+")"}).text(function(e){return 180*(e.endAngle-e.startAngle)/Math.PI>100*i.config.thresholdToLabel?e.data[i.config.labelDataKey]:""}),i.config.labelSize&&t.style("font-size",i.config.labelSize)}},i.arcGenerator=function(){return d3.svg.arc().outerRadius(i.outerRadius).innerRadius(i.innerRadius)},i.arcTween=function(e){var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){return i.arcGenerator()(t(e))}},i.computeData=function(){var t=d3.layout.pie().sort(null).value(function(e){return e[i.config.yDataKey]});i.data=t(e.data()[0].values)},i.computeRadii=function(){var t=Math.min(e.body().height(),e.body().width())/2;i.outerRadius=i.config.outerRadius||t*i.config.outerScale,i.innerRadius=i.config.innerRadius||t*i.config.innerScale},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o.length>0?(i.config.tooltip.closestPoints=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return e.map(function(e){var t="<p>";return t=t+"<b>"+e.data.id+": </b>"+(100*((e.endAngle-e.startAngle)/(2*Math.PI))).toFixed(2)+"%<br />",t+"</p>"}).join("")},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-pie",n),n},lt.add("addPie",U),sonic.hpie=function(e,t){function n(t,o){var a;[i.config.cls,"sonic-hpie"],i.selection=t,i.computeData(o||{}),a=t.selectAll(".sonic-hpie."+n.id()).data(i.data,function(e){return e.id||e.key+"series"}),a.enter().append("g").classed("sonic-hpie "+n.id(),!0),a.attr("transform",function(){return"translate("+e.body().width()/2+","+e.body().height()/2+")"
}),a.each(i.drawPie),i.config.labels.show&&a.each(i.drawLabels),a.exit().remove(),e.registerVisibleContent(n,n.hasContent)}var i={config:{id:null,seriesKey:null,colors:sonic.colors.colorMap(),tooltip:{},colorByKey:"group",labels:{show:!0,threshold:Math.PI/6,pointsPerPixel:1/6}}};return i.computeData=function(t){var n,o=d3.layout.partition().sort(null).size([2*Math.PI,Math.pow(Math.min(e.body().width(),e.body().height())/2,2)]).value(function(e){return e.size||1});i.data=[],t.remove||(n=e.dataBySeries(i.config.seriesKeys,null).filter(function(e){return e.values.length>0?!0:void 0}),i.data=n.map(function(e){return e.values=o.nodes(e.values[0]),e}))},i.arcGenerator=function(){return d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)})},i.arcTween=function(e){var t=d3.interpolate({x:this._current.x,dx:this._current.dx},e);return this._current=t(0),function(e){return i.arcGenerator()(t(e))}},i.updateSlice=function(){d3.select(this).transition().delay(e.animation().delay).duration(e.animation().duration).attrTween("d",i.arcTween)},i.drawPie=function(e){var t=d3.select(this).selectAll(".pie-series").data(e.values,function(e){return e.name+"_"+e.id});t.enter().append("path").classed("pie-series",!0).attr("id",function(e){return e.id}).attr("d",i.arcGenerator()).style("fill",function(e){return e.color||i.config.colors(e[i.config.colorByKey]||e.name)}).attr("fill-opacity",1).attr("stroke-width",1).attr("stroke-opacity",1).attr("stroke",function(e){var t=e.color||i.config.colors(e[i.config.colorByKey]||e.name);return""+d3.rgb(t).darker()}).each(function(e){this._current=e}),t.each(i.updateSlice),t.exit().remove()},i.drawLabels=function(e){var t=d3.select(this).selectAll(".sonic-hpie-labels").data(e.values,function(e){return e.name+"_"+e.id});t.enter().append("text").classed("sonic-hpie-labels",!0).attr("dy",20).attr("dx",10).style("font-weight","bold").append("textPath").classed("label-textpath",!0).attr("xlink:href",function(e){return"#"+e.id}),t.selectAll(".label-textpath").text(i.calcLabelText),t.exit().remove()},i.calcLabelText=function(e){var t=(Math.sqrt(e.y+e.dy)-Math.sqrt(e.y))/2+Math.sqrt(e.y),n=t*e.dx,o=Math.floor(n*i.config.labels.pointsPerPixel);return e.dx<i.config.labels.threshold||0===e.depth?"":e.name.length>o?e.name.substring(0,Math.max(3,o-3))+"...":e.name},i.calcLabelTranslate=function(e){var t=i.arcGenerator().centroid(e);return e.x===2*Math.PI?0:t},i.calcLabelRotation=function(e){var t,n=0,i=e.x+e.dx/2;if(e.dx===2*Math.PI)return 0;switch(t=Math.PI/2>=i?1:Math.PI>=i?4:3*Math.PI/2>=i?3:2){case 1:n=180*-1*(Math.PI/2-i)/Math.PI;break;case 4:n=180*(i-Math.PI/2)/Math.PI;break;case 3:n=180*-1*(3*Math.PI/2-i)/Math.PI;break;case 2:n=180*(i-3*Math.PI/2)/Math.PI}return n},n.highlightSlices=function(e){i.selection.selectAll(".pie-series").each(function(t){var n=sonic.object.keys(e).length>0?!0:!1;sonic.each(e,function(e,i){sonic.array.contains(i,t[e])||(n=!1)}),n?d3.select(this).classed("sonic-hpie-selected",!0):d3.select(this).classed("sonic-hpie-selected",!1)})},i.renderTooltips=function(e){return e.map(function(e){var t="<p>";return t=t+"<b>"+e.name+": </b>"+(100*(e.dx/(2*Math.PI))).toFixed(2)+"% ("+e.value+")<br />",t+"</p>"}).join("")},i.onVizClick=function(e){var t=i.closestPoints(e);return t},i.onVizMouseMove=function(e){var t=i.closestPoints(e);return i.updateTooltips(e,t),i.selection.selectAll(".pie-series").each(function(e){sonic.array.contains(t,e)?d3.select(this).classed("sonic-hpie-hover",!0).attr("stroke",function(e){var t=e.color||i.config.colors(e[i.config.colorByKey]||e.name);return""+d3.rgb(t).darker().darker()}).style("fill",function(e){var t=e.color||i.config.colors(e[i.config.colorByKey]||e.name);return""+d3.rgb(t).brighter()}):d3.select(this).classed("sonic-hpie-hover",!1).style("fill",function(e){return e.color||i.config.colors(e[i.config.colorByKey]||e.name)}).attr("stroke",function(e){var t=e.color||i.config.colors(e[i.config.colorByKey]||e.name);return""+d3.rgb(t).darker()})}),t},i.closestPoints=function(t){var n,o,a=[],c=t,r=[e.body().width()/2,e.body().height()/2],l=-1;if(c){switch(n=[c[0]-r[0],c[1]-r[1]],o=0>n[0]?0>n[1]?1:4:0>n[1]?2:3,n=n.map(function(e){return Math.abs(e)}),o){case 1:l=2*Math.PI-Math.atan(n[0]/n[1]);break;case 2:l=Math.atan(n[0]/n[1]);break;case 3:l=Math.PI-Math.atan(n[0]/n[1]);break;case 4:l=Math.PI+Math.atan(n[0]/n[1])}n=sonic.geom.pythagorize(n[0],n[1])}return i.data.forEach(function(e){sonic.each(e.values,function(e,t){i.isSliceSelected(l,n,t)&&a.push(t)})}),a},i.isSliceSelected=function(e,t,n){return n.x>e||e>n.x+n.dx?!1:Math.sqrt(n.y)>t||t>Math.sqrt(n.y+n.dy)?!1:!0},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-hpie",n),n},lt.add("addHPie",Q),lt.add("highlightSlices",$),sonic.punchcard=function(e,t){function n(t,o){var a;[i.config.cls,"sonic-punchcard"],i.selection=t,i.computeData(o||{}),i.setScales(),a=t.selectAll(".sonic-punchcard."+n.id()).data(i.data,function(e){return e.key}),a.enter().append("g").classed("sonic-punchcard "+n.id(),!0),a.each(i.drawPunches),a.exit().remove(),e.registerVisibleContent(n,n.hasContent())}var i={xScale:null,yScale:null,min:null,max:null,config:{id:null,cls:"",xDataKey:"x",yDataKey:"y",zDataKey:"z",xScaleId:null,yScaleId:null,stroke:t&&t.fill&&!t.stroke?t.fill:"black",fill:t&&t.stroke&&!t.fill?t.stroke:"black",fillOpacity:1,radius:[2,10],clickable:!0,tooltip:{buffer:null,type:"grouped"}}};return n.hasContent=sonic.override(function(){var e=!1;return i.data.length>0&&i.data.forEach(function(t){return t.values.length>0?(e=!0,void 0):void 0},this),e}),i.onVizMouseMove=function(e){var t;return e&&(t=i.closestPoints(e)),i.updateTooltips(e,t),i.selection.selectAll("circle:not(.selected)").classed("hovered",function(e){return sonic.isSet(t)?i.isClosestPoint(e,t):!1}).attr("fill",i.getPunchFill).attr("stroke",function(){return d3.rgb(i.getPunchFill.apply(this,arguments)).darker()}),t},i.onVizClick=function(e){var t;return e&&(t=i.closestPoints(e)),i.config.clickable&&i.selection.selectAll("circle").classed("selected",function(e){return sonic.isSet(t)?i.isClosestPoint(e,t):!1}).classed("hovered",!1).attr("fill",i.getPunchFill).attr("stroke",function(){return d3.rgb(i.getPunchFill.apply(this,arguments)).darker()}),t},i.closestPoints=function(e){var t,n=e[0],o=e[1];return t=i.data.map(function(e){return{key:e.key,dist:null,point:null}}),i.data.forEach(function(e,a){e.values.forEach(function(e){var c,r,l;c=i.xScale.position(e[i.config.xDataKey])+("ordinal"===i.xScale.type()?i.xScale.rangeBand()/2:0)-n,r=i.yScale.position(e[i.config.yDataKey])+("ordinal"===i.yScale.type()?i.yScale.rangeBand()/2:0)-o,l=Math.sqrt(c*c+r*r),(!t[a].point||t[a].dist>l)&&(t[a].point=e,t[a].dist=l)})}),t=t.reduce(function(e,t){return(0===e.length||t.dist<e[0].dist)&&sonic.isSet(t.point)?[t]:e},[])},i.setScales=function(){sonic.isSet(i.config.xScale)?(i.xScale=i.config.xScale,i.config.xScaleId=e.register("scale",i.xScale),delete i.config.xScale):i.config.xScaleId?i.xScale=e.findOne("scale",i.config.xScaleId):(i.xScale=e.findOne("scale",{dataKey:i.config.xDataKey}),i.config.xScaleId=i.xScale.id()),sonic.isSet(i.config.yScale)?(i.yScale=i.config.yScale,i.config.yScaleId=e.register("scale",i.yScale),delete i.config.yScale):i.config.yScaleId?i.yScale=e.findOne("scale",i.config.yScaleId):(i.yScale=e.findOne("scale",{dataKey:i.config.yDataKey}),i.config.yScaleId=i.yScale.id())},i.computeData=function(e){i.data=[],e.remove||(i.data=i.aggregateDuplicates(),i.calcExtrema())},i.aggregateDuplicates=function(){var t=[],n={},o=e.data();return o.forEach(function(e){t.push(e.key),e.values.forEach(function(e){var t=e[i.config.xDataKey]+"-"+e[i.config.yDataKey];n[t]?n[t][i.config.zDataKey]=n[t][i.config.zDataKey]+e[i.config.zDataKey]:n[t]=e})}),[{key:"aggregated:"+t.join("-"),values:Object.keys(n).map(function(e){return n[e]})}]},i.calcExtrema=function(){i.min=null,i.max=null,i.data.forEach(function(e){e.values.forEach(function(e){(!sonic.isSet(i.min)||e[i.config.zDataKey]<i.min)&&(i.min=e[i.config.zDataKey]),(!sonic.isSet(i.max)||e[i.config.zDataKey]>i.max)&&(i.max=e[i.config.zDataKey])})})},i.drawPunches=function(){var t;t=d3.select(this).selectAll("circle").data(function(e){return e.values},function(e){return e.id}),t.enter().append("circle").attr("r",0),t.transition().delay(e.animation().delay).duration(e.animation().duration).attr("fill",i.getPunchFill).attr("fill-opacity",i.config.fillOpacity).attr("cx",function(e){return i.xScale.position(e[i.config.xDataKey])+("ordinal"===i.xScale.type()?i.xScale.rangeBand()/2:0)}).attr("cy",function(e){return i.yScale.position(e[i.config.yDataKey])+("ordinal"===i.yScale.type()?i.yScale.rangeBand()/2:0)}).attr("stroke",function(){return d3.rgb(i.getPunchFill.apply(this,arguments)).darker()}).attr("r",function(e){var t;return t=i.max!==i.min?(e[i.config.zDataKey]-i.min)/(i.max-i.min):.5,i.config.radius[0]+t*(i.config.radius[1]-i.config.radius[0])}),t.exit().remove()},i.updateTooltips=function(t,o){var a=i.config.tooltip.renderFn||i.renderTooltips;i.config.tooltip&&(t&&o?(i.config.tooltip.closestPoint=o,i.config.tooltip.content=a(o,t),i.config.tooltip.associatedId=n.id(),i.config.tooltip.mouse=t,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.renderTooltips=function(e){return 0===e.length?void 0:"<p><b>"+i.config.xDataKey+": </b>"+e[0].point[i.config.xDataKey]+"<br />"+"<b>"+i.config.yDataKey+": </b>"+e[0].point[i.config.yDataKey]+"<br />"+"<b>"+i.config.zDataKey+": </b>"+e[0].point[i.config.zDataKey]+"</p>"},i.isClosestPoint=function(e,t){var n=!1;return t.forEach(function(t){t.point&&t.point.id===e.id&&(n=!0)}),n},i.getSelected=function(){return sonic.svg.hasClass(this,"selected")},i.getHovered=function(){return sonic.svg.hasClass(this,"hovered")},i.getPunchFill=function(e,t){var n=i.config.fill;return sonic.isSet(i.data[0].color)&&(n=i.data[0].color),sonic.isSet(e.color)&&(n=e.color),(i.getSelected.call(this,e,t)||i.getHovered.call(this,e,t))&&(n=""+d3.rgb(n).brighter(3)),n},sonic.augment(n,i,e,"registerable","listenable"),n.mergeConfig(t),e.register("sonic-punchcard",n),n},lt.add("addPunchcard",J),lt.add("addPunches",J),lt.add("updatePunchcard",tt),lt.add("updatePunches",tt),lt.add("removePunches",et),sonic.geo={},sonic.geo.choropleth=function(e,t){function n(e,t){var o,a=[i.config.cls,"sonic-choropleth",n.id()];i.selection=e,i.computeProjection(),i.computePath(),i.computeZoom(),i.computeData(t),i.setScales(),o=e.selectAll(a.join(".")).data(data,function(e){return e.key}),o.enter().append("g").classed(a.join(" "),!0),o.each(i.drawGeos),o.exit().remove()}var i={scale:null,defaultColors:sonic.colors.colorMap(),projection:null,path:null,config:{id:null,cls:"",dataKey:"val",seriesKeys:null,seriesIndexes:null,colors:null,colorScheme:"Blues",buckets:9,baseGeos:{types:[],counties:{mesh:!1,fill:"#A4A4A4",stroke:"none"},states:{mesh:!0,fill:"none",stroke:"#FFF"},nielsen_zones:{mesh:!1,fill:"#A4A4A4",stroke:"#FFF"},topology:null},projection:{type:"albersUsa",scale:1070,translate:"center"},tooltip:{renderFn:null}}};return i.computeData=function(t){t=t||{},data=[],t.remove||(data=e.dataBySeries(i.config.seriesKeys,i.config.seriesIndexes))},i.setScales=function(){i.scale=d3.scale.quantile().domain(data.reduce(function(e,t){return e.concat(sonic.array.pluck(t.values,i.config.dataKey))},[])).range(d3.range(0,i.config.buckets))},i.drawGeos=function(e,t){var n=this,o=[{key:"countyId",type:"counties"},{key:"stateId",type:"states"},{key:"dmaId",type:"nielsen_zones"}];o.forEach(function(o){-1!==i.config.baseGeos.types.indexOf(o.type)&&(i.config.baseGeos[o.type].mesh?i.drawMeshFeature.call(n,o,e,t):i.drawMultiFeature.call(n,o,e,t))})},i.drawMeshFeature=function(e){var t,n=e.type;t=d3.select(this).selectAll("."+n).data([1]),t.enter().append("g").classed(n,!0).append("path"),t.select("path").datum(topojson.mesh(i.config.baseGeos.topology,i.config.baseGeos.topology.objects[n],function(e,t){return e!==t})).style("fill",i.config.baseGeos[n].fill).style("stroke",i.config.baseGeos[n].stroke).attr("d",i.path)},i.drawMultiFeature=function(t,n){var o,a,c=t.type,r=n.values;r.sort(sonic.sortByProp(t.key)),a=d3.select(this).selectAll("."+c).data([1]),a.enter().append("g").classed(c,!0),o=a.selectAll("path").data(topojson.feature(i.config.baseGeos.topology,i.config.baseGeos.topology.objects[c]).features,function(e){return e.id}),o.enter().append("path").on("mouseover",function(t){d3.select(this).classed("sonic-geo-polygon-highlight",!0),i.updateTooltips(t.id,e.mouse(this))}).on("mouseout",function(){d3.select(this).classed("sonic-geo-polygon-highlight",!1),i.updateTooltips()}).on("click",i.handleClick),o.transition().delay(e.animation().delay).duration(e.animation().duration).style("stroke",i.config.baseGeos[c].stroke).style("fill",function(e){var o;return o=sonic.array.binarySearch(n.values,function(n){return n[t.key]<e.id?-1:n[t.key]>e.id?1:0}),i.getColor(sonic.isSet(o)?n.values[o][i.config.dataKey]:null)||i.config.baseGeos.counties.fill}).attr("d",i.path)},i.updateTooltips=function(t,o){var a,c=i.config.tooltip.renderFn||i.renderTooltips;o&&(a=i.closestPoints(t)),i.config.tooltip&&(sonic.isSet(t)?(i.config.tooltip.mouse=o,i.config.tooltip.associatedId=n.id(),i.config.tooltip.content=c(a,o),i.config.tooltip.cp=a,e.showTooltip(i.config.tooltip)):e.hideTooltip(i.config.tooltip))},i.closestPoints=function(e){var t=data[0].values;return t=t.filter(function(t){return t.dmaId===e})},i.renderTooltips=function(e){return"<p>id : "+e.dmaId},i.computeProjection=function(){var t=[e.body().width()/2,e.body().height()/2];i.projection?t=i.projection.translate():sonic.isArray(i.config.projection.translate)&&(t=i.config.projection.translate),i.projection=d3.geo[i.config.projection.type]().scale(i.projection?i.projection.scale():i.config.projection.scale).translate(t)},i.computePath=function(){i.path=d3.geo.path().projection(i.projection)},i.computeZoom=function(){e.body().call(d3.behavior.zoom().translate(i.projection.translate()).scale(i.projection.scale()).scaleExtent([e.body().height(),8*e.body().height()]).on("zoom",i.handleZoom))},i.getColor=function(e){var t,n=i.scale(e);if(e)return t=i.config.colors?i.config.colors[n]:colorbrewer?colorbrewer[i.config.colorScheme][Math.min(i.config.buckets,9)][n]:i.defaultColors(n)},i.handleClick=function(t){var n=i.path.centroid(t),o=i.projection.translate();i.projection.translate([o[0]-n[0]+e.body().width()/2,o[1]-n[1]+e.body().height()/2]),i.selection.selectAll("path").transition().duration(2e3).attr("d",i.path)},i.handleZoom=function(){i.projection.translate(d3.event.translate).scale(d3.event.scale),i.selection.selectAll("path").attr("d",i.path)},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),e.register("sonic-choropleth",n),n},lt.add("addChoropleth",nt),lt.add("updateChoropleth",it),lt.add("removeChoropleth",ot),sonic.legend=function(e,t){function n(t,o){t.selectAll(".sonic-legend."+n.id()).remove(),i.selection=t,setTimeout(function(){var e;[i.config.cls,"sonic-legend"],i.selection=t,i.computeData(o||{}),e=t.selectAll(".sonic-legend."+n.id()).data(i.data),e.enter().append("g").classed("sonic-legend "+n.id(),!0).style("font-size",i.config.style.fontSize).style("font",i.config.style.font),e.each(i.drawLegend),e.order(),e.exit().remove()},Math.max(2*e.animation().duration,1e3))}var i={config:{legends:[],cls:"",style:{fill:"white",stroke:"black",opacity:.8,fontSize:"10px",font:"sans-serif",fontColor:"black",padding:5}}};return i.computeData=function(e){i.data=[],e.remove||(i.data=i.config.legends)},i.drawLegend=function(t){var n,o=d3.select(this),a={},c=e.body(),r=sonic.isArray(t.id)?t.id:[t.id],l=i.config.style.padding,s=r.map(function(e){return e+"-data-legend"}),d=c.selectAll("["+s.join("],[")+"]"),f=o.selectAll(".legend-box").data(d[0].length>0?[1]:[]),u=o.selectAll(".legend-items").data(d[0].length>0?[1]:[]);o.attr("transform","translate("+e.body().width()*t.pos[0]+","+e.body().height()*t.pos[1]+")"),f.enter().append("rect").classed("legend-box",!0).style("fill",i.config.style.fill).style("opacity",i.config.style.opacity).style("stroke",i.config.style.stroke),u.enter().append("g").classed("legend-items",!0),d.each(function(){var e=d3.select(this),t=s.filter(function(t){return sonic.isSet(e.attr(t))})[0];a[e.attr(t)]={pos:e.attr("data-legend-pos")||this.getBBox().y,color:sonic.isSet(e.attr("data-legend-color"))?e.attr("data-legend-color"):"none"!==e.style("fill")?e.style("fill"):e.style("stroke")}}),a=d3.entries(a).sort(function(e,t){return e.value.pos-t.value.pos}),u.selectAll("text").data(a,function(e){return e.key}).call(function(e){e.enter().append("text")}).call(function(e){e.exit().remove()}).attr("y",function(e,t){return t+"em"}).attr("x","1em").attr("fill",i.config.style.fontColor).text(function(e){return e.key}),u.selectAll("circle").data(a,function(e){return e.key}).call(function(e){e.enter().append("circle")}).call(function(e){e.exit().remove()}).attr("cy",function(e,t){return t-.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(e){return e.value.color}),d[0].length>0&&(n=u[0][0].getBBox(),f.attr("x",n.x-l).attr("y",n.y-l).attr("height",n.height+2*l).attr("width",n.width+2*l)),u.exit().remove(),f.exit().remove()},sonic.augment(n,i,e,"registerable"),n.mergeConfig(t),e.register("sonic-legend",n),n},lt.add("addLegend",at),lt.add("updateLegend",rt),lt.add("removeLegend",ct),sonic.viz=function(){function e(n){return sonic.svg.height(n)&&sonic.svg.width(n)?("auto"===t.config.sizeMode?(e.height(sonic.svg.height(n)),e.width(sonic.svg.width(n))):(e.height(t.config.height),e.width(t.config.width)),e.container().empty()&&(n.call(t.drawContainer),t.config.visibleClear===!0&&t.addClearLink(),t.addDefaultListeners()),e.container().attr("width",e.width()).attr("height",e.height()),e.body().data(t.data),t.translateBody(),t.registry.update(),t.hiddenUpdates=!1,void 0):(t.hiddenUpdates=!0,void 0)}var t={elId:null,api:null,registry:null,listener:null,tooltip:null,zoom:{zoomer:null,cbs:{zoomstart:{},zoom:{},zoomend:{}}},config:{sizeMode:"auto",width:null,height:null,margin:{top:10,right:10,bottom:7,left:7},currentPadding:{top:0,right:0,bottom:0,left:0},padding:{top:"auto",right:"auto",bottom:"auto",left:"auto"},animation:{delay:0,duration:1e3},tooltip:!1,noContentMessage:"No Data Available",visibleClear:!1},hiddenUpdates:!1};return t.api=lt,t.registry=sonic.registry(),t.listener=sonic.listener(e,t.registry),t.tooltip=sonic.tooltip(e),e.data=function(n,i){return sonic.isSet(i)||(i=!0),sonic.isSet(n)?(t.data=sonic.nest(n),i&&e.update(),e):t.data},e.dataByKey=function(t){var n=e.data().filter(function(e){return e.key===t?!0:void 0});return n.length>0?n[0]:void 0},e.dataByIndex=function(t){var n=e.data().filter(function(e,n){return n===t?!0:void 0});return n.length>0?n[0]:void 0},e.dataBySeries=function(t,n){return e.data().filter(function(e,i){var o=!1;return sonic.isSet(t)?sonic.isArray(t)?t.forEach(function(t){sonic.isRegex(t)?t.test(e.key)&&(o=!0):t===e.key&&(o=!0)}):sonic.isRegex(t)?t.test(e.key)&&(o=!0):t===e.key&&(o=!0):sonic.isSet(n)?sonic.isArray(n)&&-1!==n.indexOf(i)?o=!0:n===i&&(o=!0):o=!0,o})},e.width=function(n){return sonic.getOrSet("width",n,t.config,e)},e.height=function(n){return sonic.getOrSet("height",n,t.config,e)},e.container=function(){return t.selection.select(".sonic-viz")},e.margin=function(n,i){var o=sonic.getOrSet("margin",n,t.config,e);return sonic.isSet(n)&&e.refreshRegistry(i),t.translateBody(),o},e.currentPadding=function(n,i){var o=sonic.getOrSet("currentPadding",n,t.config,e);return sonic.isSet(n)&&sonic.isSet(i)&&(e.refreshRegistry(i),t.translateBody()),o},e.padding=function(){return t.config.padding},e.mouse=function(t){var n=d3.mouse(t),i=e.margin(),o=e.currentPadding();return[n[0]-i.left-o.left,n[1]-i.top-o.top]},e.mouse.inBody=function(t){return t[0]<=e.body().width()&&t[0]>=0&&t[1]<=e.body().height()&&t[1]>=0},e.body=function(){var n=e.container().select(".sonic-viz-body");return n.width=function(){return e.width()-t.config.margin.left-t.config.margin.right-t.config.currentPadding.left-t.config.currentPadding.right},n.height=function(){return e.height()-t.config.margin.top-t.config.margin.bottom-t.config.currentPadding.top-t.config.currentPadding.bottom},n},e.animation=function(n){return!sonic.isSet(n)&&t.hiddenUpdates?{duration:1e3,delay:0}:sonic.getOrSet("animation",n,t.config,e)},e.addZoom=function(n,i,o,a){t.zoom.zoomer||(t.zoom.zoomer=d3.behavior.zoom().x(o.scale()).y(a.scale()).on("zoomstart",t.zoomStartAction).on("zoom",t.zoomAction).on("zoomend",t.zoomEndAction),e.container().call(t.zoom.zoomer),e.container().selectAll(".sonic-clear-link").text("reset"),e.addListeners({".sonic-clear-link":{click:function(){t.zoom.zoomer.translate([0,0]).scale(1),t.zoomAction()}}})),t.zoom.zoomer.x()!==o.scale()&&t.zoom.zoomer.x(o.scale()),t.zoom.zoomer.y()!==a.scale()&&t.zoom.zoomer.y(a.scale()),t.setupZoomCallbacks(n,i)},e.getZoom=function(){return t.zoom},t.setupZoomCallbacks=function(e,n){sonic.each(n,function(n,i){t.zoom.cbs[n][e]=function(){i.fn(i.opts)}})},t.zoomStartAction=function(){t.zoom.holdAnimation=sonic.clone(e.animation()),e.animation({duration:0,delay:0}),e.container().select(".sonic-clear-link").style("display","block"),sonic.each(t.zoom.cbs.zoomstart,function(e,t){t()})},t.zoomAction=function(){sonic.each(t.zoom.cbs.zoom,function(e,t){t()}),e.find("sonic-axis").forEach(function(e){e.update()})},t.zoomEndAction=function(){sonic.each(t.zoom.cbs.zoomend,function(e,t){t()}),e.animation(t.zoom.holdAnimation)},e.refreshRegistry=t.registry.refresh,e.onBodyClick=function(){e.container().select(".sonic-clear-link").style("display","block")},e.onClearClick=function(){e.container().select(".sonic-clear-link").style("display","none")},e.clear=function(){e.onClearClick(),t.registry.applyFn("handleEvent",[".sonic-clear-link","click"])},e.tooltipSingleton=function(){return t.tooltip},e.listenerSingleton=function(){return t.listener},e.componentSingleton=function(){return t.registry},e.elId=function(){return t.elId},e.hasVisibleContent=function(){return t.registry.visibleContent().length>0},e.registry=function(){return t.registry},e.registerVisibleContent=function(n,i){t.registry.registerVisibleContent(n,i),e.drawNoContentMessage()},e.drawNoContentMessage=function(){var n=e.body().selectAll("text.nocontentmessage").data(e.hasVisibleContent()?[]:[1]);n.enter().append("text").classed("nocontentmessage",!0).style("text-anchor","middle").text(t.config.noContentMessage),n.attr("x",e.body().width()/2).attr("y",e.body().height()/2),n.exit().remove()},t.translateBody=function(){e.body().attr("transform","translate("+(t.config.margin.left+t.config.currentPadding.left)+","+(t.config.margin.top+t.config.currentPadding.top)+")")},t.init=function(n){t.elId=n[0],t.selection=d3.select(t.elId),n[1]&&(sonic.isArray(n[1])?e.data(n[1],!1):e.mergeConfig(n[1])),n[2]&&e.mergeConfig(n[2]),t.config.tooltip&&t.tooltip.mergeConfig(t.config.tooltip),(t.config.height||t.config.width)&&(t.config.sizeMode="manual"),t.bindAPIMethods(),e.update()},t.drawContainer=function(e){e.append("svg").classed("sonic-viz",!0).append("g").classed("sonic-viz-body",!0).data(t.data)},t.bindAPIMethods=function(){t.api.methods().forEach(function(t,n){e[t]=function(){var t=n.apply(this,[e].concat(sonic.argsToArr(arguments)));return void 0!==t?t:e}})},t.addClearLink=function(){var t=e.container().selectAll(".sonic-clear-link").data([1]);t.enter().append("text").classed("sonic-clear-link",!0).text("clear").style("display","none"),t.attr("x",e.width()-e.margin().right-20).attr("y",e.height()-10)},t.addDefaultListeners=function(){return e.addListeners({vizbodywide:{mousemove:null,click:e.onBodyClick}}),t.config.visibleClear===!0&&e.addListeners({".sonic-clear-link":{click:e.onClearClick}}),e},sonic.augment(e,t,e,"registerable"),window.addEventListener("resize",function(){e.update()}),t.init(sonic.argsToArr(arguments)),e}})();